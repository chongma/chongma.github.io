!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.AxfBean=r():e.AxfBean=r()}(this,(function(){return(()=>{"use strict";var e={d:(r,t)=>{for(var a in t)e.o(t,a)&&!e.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:t[a]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)},r={};function t(e){throw new TypeError('"'+e+'" is read-only')}function a(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function i(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}e.d(r,{default:()=>b});var o={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,BigInt64:8,BigUInt64:8,Float:4,Double:8},l=function(){function e(r){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a(this,e),this.endianness=t?"LE":"BE",this.buffer=r,this.position=0}return i(e,[{key:"readNumericType",value:function(e){var r=o[e],t=this.buffer.slice(this.position,this.position+r)["read"+e+(r>1?this.endianness:"")](0);return this.position+=r,t}},{key:"readDouble",value:function(){return this.readNumericType("Double")}},{key:"readFloat",value:function(){return this.readNumericType("Float")}},{key:"readShort",value:function(){return this.readNumericType("Int16")}},{key:"javaBoolean",value:function(){return-1==this.readShort()}},{key:"sexType",value:function(){return-1==this.readShort()?"MALE":"FEMALE"}},{key:"close",value:function(){}}]),e}();const u=l,s={UNLABELLED:1,WHOLE_BODY:2,LEFT_LEG:3,RIGHT_LEG:4,TORSO:5,LEFT_ARM:7,RIGHT_ARM:8,CHEST_WALL:9,LEFT_BREAST:10,RIGHT_BREAST:11,MJB_BUST:12,properties:{1:{name:"Unlabelled"},2:{name:"Whole body"},3:{name:"Left leg"},4:{name:"Right leg"},5:{name:"Torso"},7:{name:"Left arm"},8:{name:"Right arm"},9:{name:"Chest wall"},10:{name:"Left breast"},11:{name:"Right breast"},12:{name:"MJB bust"}},fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))[0]}};function _(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return L(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?L(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}function L(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}const y=function(){function e(){a(this,e)}return i(e,null,[{key:"getBodypartByRef",value:function(e,r){var t,a=_(e.bodyParts);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(s[n.id]==r)return n}}catch(e){a.e(e)}finally{a.f()}return null}},{key:"getTopLayer",value:function(e){return e.layers[e.layers.length-1]}},{key:"getBottomLayer",value:function(e){return e.layers[0]}},{key:"getDoubleLayer",value:function(e,r,t){for(var a=r;a<t;a++){var n=e.layers[a],i=e.layers[a+1];if(n.y==i.y)return a}return 0}},{key:"getNearestLayer",value:function(e,r){var t,a=null,n=32e3,i=_(e.layers);try{for(i.s();!(t=i.n()).done;){var o=t.value,l=Math.abs(o.y-r);l<n&&(n=l,a=o)}}catch(e){i.e(e)}finally{i.f()}return a}},{key:"getNearestLayerId",value:function(e,r){return null==r?-1:this.getNearestLayerID(e,r.y)}},{key:"getNearestLayerID",value:function(e,r){for(var t=32766,a=-1,n=0;n<e.layers.length;n++){var i=e.layers[n],o=Math.abs(i.y-r);o<t&&(t=o,a=n)}return a}}]),e}(),R=function(){function e(){a(this,e)}return i(e,null,[{key:"dist_2D_Dbl",value:function(e,r){var t=r.x-e.x,a=r.y-e.y;return Math.sqrt(t*t+a*a)}}]),e}(),E=function(){function e(){a(this,e)}return i(e,null,[{key:"generateSpline",value:function(e){e.parametricNodes=this.create_parametric_spline_array(e);var r={};r.xs_coeffs=this.naturalSpline(e,e.parametricNodes.xsPoints),r.ys_coeffs=this.naturalSpline(e,e.parametricNodes.ysPoints),e.parametricCoefficients=r}},{key:"create_parametric_spline_array",value:function(e){var r=0,t=[],a=[],n={x:0,y:e.nodes[0].point.x};t.push(n);var i={x:0,y:e.nodes[0].point.y};a.push(i);for(var o=1;o<e.nodes.length;o++){var l=e.nodes[o].point,u=e.nodes[o-1].point;n={x:r+=R.dist_2D_Dbl(u,l),y:l.x},t.push(n),i={x:r,y:l.y},a.push(i)}var s={};return s.xsPoints=t,s.ysPoints=a,s}},{key:"naturalSpline",value:function(e,r){var t=e.nodes.length;if(0==t)return null;for(var a=t-1,n=Array(t).fill(0),i=Array(a).fill(0),o=Array(t).fill().map((function(){return Array(t).fill(0)})),l=Array(a+1).fill(0),u=Array(t).fill(0),s=Array(t).fill(0),_=Array(t).fill(0),L=0;L<t;L++){var y=r[L];n[L]=y.x,u[L]=y.y}for(var R=0;R<a;R++)i[R]=n[R+1]-n[R];o[0][0]=1,o[0][1]=0,o[a][a]=1,o[a][a-1]=0;for(var E=1;E<a;E++)o[E][E]=2*(i[E-1]+i[E]),o[E][E-1]=i[E-1],o[E][E+1]=i[E];l[0]=0;for(var T=1;T<a;T++)l[T]=3/i[T]*(u[T+1]-u[T])-3/i[T-1]*(u[T]-u[T-1]);l[a]=0;for(var f=this.solveTridiagonalSystem(e.nodes.length,o,l),d=a-1;d>=0;d--)s[d]=(u[d+1]-u[d])/i[d]-i[d]*(f[d+1]+2*f[d])/3,_[d]=(f[d+1]-f[d])/(3*i[d]);for(var m=[],c=0;c<a;c++){var h={a:u[c],b:s[c],c:f[c],d:_[c]};m.push(h)}return m}},{key:"solveTridiagonalSystem",value:function(e,r,t){var a=Array(e).fill().map((function(){return Array(e).fill(0)})),n=Array(e).fill().map((function(){return Array(e).fill(0)})),i=Array(e).fill(0),o=Array(e).fill(0),l=e-1;if(e>=3){a[0][0]=r[0][0],n[0][1]=r[0][1]/a[0][0];for(var u=1;u<l;u++)a[u][u-1]=r[u][u-1],a[u][u]=r[u][u]-a[u][u-1]*n[u-1][u],n[u][u+1]=r[u][u+1]/a[u][u];a[l][l-1]=r[l][l-1],a[l][l]=r[l][l]-a[l][l-1]*n[l-1][l],i[0]=t[0]/a[0][0];for(var s=1;s<e;s++)i[s]=(t[s]-a[s][s-1]*i[s-1])/a[s][s];o[l]=i[l];for(var _=l-1;_>=0;_--)o[_]=i[_]-n[_][_+1]*o[_+1]}return o}},{key:"splineLength",value:function(e,r,t){for(var a=0,n=0,i=r;i<t;i++){for(var o=e.parametricCoefficients.xs_coeffs[i],l=e.parametricCoefficients.ys_coeffs[i],u=e.parametricNodes.xsPoints[i].x,s=e.parametricNodes.xsPoints[i].x,_=(s-u)/22,L=this.fs(o,l,u,u),y=this.fs(o,l,u,s),R=0,E=1;E<10;E++){a=u+(2*E-1)*_;var T=this.fs(o,l,u,a);a=u+2*E*_,R=R+4*T+2*this.fs(o,l,u,a)}a+=_,n+=_*(L+R+4*this.fs(o,l,u,a)+y)/3}return n}},{key:"fs",value:function(e,r,t,a){var n=a-t,i=e.b+2*e.c*n+3*e.d*n*n,o=r.b+2*r.c*n+3*r.d*n*n;return Math.sqrt(Math.pow(i,2)+Math.pow(o,2))}},{key:"getNodeFirst",value:function(e){return e.nodes[0]}},{key:"getNodeLast",value:function(e){return e.nodes[e.nodes.length-1]}},{key:"regeneratePointsOnSpline",value:function(e,r,t,a,n){var i=[],o=0;if(t>=0&&a>0){var l=e.parametricNodes.xsPoints[t].x;o=(e.parametricNodes.xsPoints[a].x-l)/(r-1);var u=l,s=t,_=e.parametricNodes.xsPoints[s+1].x;if(0!=o)for(var L=0;L<r;L++){for(var y=l+L*o;y>_+1e-4;)s++,u=e.parametricNodes.xsPoints[s].x,_=e.parametricNodes.xsPoints[s+1].x;var R=e.parametricCoefficients.xs_coeffs[s],E=e.parametricCoefficients.ys_coeffs[s],T={point:{x:this.polynomial_value(R,u,y),y:this.polynomial_value(E,u,y)}};if(n){var f={},d=(y-e.parametricNodes.xsPoints[s].x)/(e.parametricNodes.xsPoints[s+1].x-e.parametricNodes.xsPoints[s].x);f.x=(1-d)*e.nodes[s].colour.x+d*e.nodes[s+1].colour.x,f.y=(1-d)*e.nodes[s].colour.y+d*e.nodes[s+1].colour.y,f.z=(1-d)*e.nodes[s].colour.z+d*e.nodes[s+1].colour.z,T.colour=f}i.push(T)}}return 0==o||t<0||a<0?null:i}},{key:"polynomial_value",value:function(e,r,t){var a=t-r;return e.a+e.b*a+e.c*a*a+e.d*a*a*a}},{key:"addDistinctNode",value:function(e,r,t){if(null==e.nodes)e.nodes=[];else if(0==t);else if(!(Math.abs(r.x-this.getNodeLast(e).point.x)+Math.abs(r.y-this.getNodeLast(e).point.y)>=t))return!1;var a={point:{x:r.x,y:r.y}};return e.nodes.push(a),!0}},{key:"remove_end_node",value:function(e){e.nodes.length>1?e.nodes.pop():e.nodes=[]}},{key:"getNearestNodeY",value:function(e,r){var t=-1;if(e.nodes.length){t=0;for(var a=Math.abs(this.getNodeFirst(e).point.y-r),n=0;n<e.nodes.length;n++){var i=Math.abs(e.nodes[n].point.y-r);i<a&&(t=n,a=i)}}return t}},{key:"NodeAtLength",value:function(e,r){var t=0,a=this.splineLength(e,0,e.nodes.length-1);if(a>0)for(var n=r*a/100,i=0,o=this.splineLength(e,0,i),l=100*o/a,u=Math.abs(l-r);o<n&&i<e.nodes.length-1;)i+=1,l=100*(o=this.splineLength(e,0,i))/a,Math.abs(l-r)<u&&(u=Math.abs(l-r),t=i);return e.nodes[t]}}]),e}();function T(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return f(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}function f(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}const d=function(){function e(){a(this,e)}return i(e,null,[{key:"calculateExtentBody",value:function(e){var r,t=this.initialise(),a=T(e.bodyParts);try{for(a.s();!(r=a.n()).done;){var n=r.value;this.calculateExtentBodypart(n),this.compare3dExtent(t,n.extent)}}catch(e){a.e(e)}finally{a.f()}this.normalise(t),e.extent=t}},{key:"calculateExtentBodypart",value:function(e){var r,t=this.initialise(),a=T(e.layers);try{for(a.s();!(r=a.n()).done;){var n=r.value;this.calculateExtentLayer(n),this.compare3dExtent(t,n.extent)}}catch(e){a.e(e)}finally{a.f()}if(null!=e.splineRegions){var i,o=T(e.splineRegions);try{for(o.s();!(i=o.n()).done;){var l=i.value;null!=l.vertices?l.extent=this.calculate(l.vertices):console.error(l," Vertices list is NULL")}}catch(e){o.e(e)}finally{o.f()}}this.normalise(t),e.extent=t}},{key:"calculateExtentLayer",value:function(e){var r=this.initialise();if(null!=e.pointLayer){var t,a=T(e.pointLayer.points);try{for(a.s();!(t=a.n()).done;){var n=t.value;this.compare3dPoint(r,n)}}catch(e){a.e(e)}finally{a.f()}}null!=e.splineLayer&&(null!=e.splineLayer.surface&&(this.calculateExtentCubicSpline(e.splineLayer.surface),this.compare3dLayer(r,e.splineLayer.surface.extent,e.y)),null!=e.splineLayer.tape&&(this.calculateExtentCubicSpline(e.splineLayer.tape),this.compare3dLayer(r,e.splineLayer.tape.extent,e.y))),this.normalise(r),e.extent=r}},{key:"calculateExtentCubicSpline",value:function(e){if(e.nodes.length>2){e.extent=this.initialise2d(),e.samplePoints=E.regeneratePointsOnSpline(e,200,0,e.nodes.length-1,!1);var r,t=T(e.samplePoints);try{for(t.s();!(r=t.n()).done;){var a=r.value.point;this.compare_with_coordinate2D(e.extent,a.x,a.y)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"compare2d",value:function(e,r){r.x>e.max.x&&(e.max.x=r.x),r.x<e.min.x&&(e.min.x=r.x),r.y>e.max.y&&(e.max.y=r.y),r.y<e.min.y&&(e.min.y=r.y)}},{key:"compare3dExtent",value:function(e,r){r.max.x>e.max.x&&(e.max.x=r.max.x),r.min.x<e.min.x&&(e.min.x=r.min.x),r.max.y>e.max.y&&(e.max.y=r.max.y),r.min.y<e.min.y&&(e.min.y=r.min.y),r.max.z>e.max.z&&(e.max.z=r.max.z),r.min.z<e.min.z&&(e.min.z=r.min.z)}},{key:"compare3dPoint",value:function(e,r){r.x>e.max.x&&(e.max.x=r.x),r.x<e.min.x&&(e.min.x=r.x),r.y>e.max.y&&(e.max.y=r.y),r.y<e.min.y&&(e.min.y=r.y),r.z>e.max.z&&(e.max.z=r.z),r.z<e.min.z&&(e.min.z=r.z)}},{key:"compare3dLayer",value:function(e,r,t){e.min.x=r.min.x,e.min.y=t,e.min.z=r.min.y,e.max.x=r.max.x,e.max.y=t,e.max.z=r.max.y}},{key:"compare_with_coordinate2D",value:function(e,r,t){r>e.max.x&&(e.max.x=r),r<e.min.x&&(e.min.x=r),t>e.max.y&&(e.max.y=t),t<e.min.y&&(e.min.y=t),this.mid(e)}},{key:"initialise",value:function(){return this.initialiseMaxMin({x:-32700,y:-32700,z:-32700},{x:32700,y:32700,z:32700})}},{key:"initialise2d",value:function(){return{min:{x:32700,y:32700},mid:{x:0,y:0},max:{x:-32700,y:-32700}}}},{key:"initialiseMaxMin",value:function(e,r){var t={max:e,min:r};return this.normalise(t),t}},{key:"normalise",value:function(e){e.mid=this.centre(e),e.difference=this.difference(e)}},{key:"centre",value:function(e){return{x:(e.min.x+e.max.x)/2,y:(e.min.y+e.max.y)/2,z:(e.min.z+e.max.z)/2}}},{key:"mid",value:function(e){e.mid={x:(e.min.x+e.max.x)/2,y:(e.min.y+e.max.y)/2}}},{key:"difference",value:function(e){return{x:e.max.x-e.min.x,y:e.max.y-e.min.y,z:e.max.z-e.min.z}}},{key:"calculate",value:function(e){var r=this.initialise();for(var t in e)this.compare(r,t);return this.normalise(r),r}}]),e}();function m(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return c(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}function c(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}const h=function(){function e(){a(this,e)}return i(e,null,[{key:"centraliseBody",value:function(e){d.calculateExtentBody(e);var r,t={x:(e.extent.min.x+e.extent.max.x)/2,y:(e.extent.min.y+e.extent.max.y)/2,z:(e.extent.min.z+e.extent.max.z)/2},a=m(e.bodyParts);try{for(a.s();!(r=a.n()).done;){var n=r.value;this.centraliseBodypart(n,t)}}catch(e){a.e(e)}finally{a.f()}var i,o=m(e.landmarks);try{for(o.s();!(i=o.n()).done;){var l=i.value;l.x=l.x-t.x,l.y=l.y-t.y,l.z=l.z-t.z}}catch(e){o.e(e)}finally{o.f()}d.calculateExtentBody(e)}},{key:"centraliseVector",value:function(e,r){e.start.x=e.start.x-r.x,e.start.y=e.start.y-r.y,e.start.z=e.start.z-r.z,e.end.x=e.end.x-r.x,e.end.y=e.end.y-r.y,e.end.z=e.end.z-r.z}},{key:"centraliseBodypart",value:function(e,r){var t,a=m(e.layers);try{for(a.s();!(t=a.n()).done;){var n=t.value;this.centraliseLayer(n,r)}}catch(e){a.e(e)}finally{a.f()}}},{key:"centraliseLayer",value:function(e,r){null!=e.pointLayer&&this.centralisePointLayer(e.pointLayer,r),null!=e.splineLayer&&this.centraliseSplineLayer(e.splineLayer,r),e.y=e.y+r.y}},{key:"centralisePointLayer",value:function(e,r){var t,a=m(e.points);try{for(a.s();!(t=a.n()).done;){var n=t.value;n.x=n.x-r.x,n.z=n.z-r.z}}catch(e){a.e(e)}finally{a.f()}}},{key:"centraliseSplineLayer",value:function(e,r){null!=e.surface&&this.centraliseCubicSpline(e.surface,r),null!=e.tape&&this.centraliseCubicSpline(e.tape,r)}},{key:"centraliseCubicSpline",value:function(e,r){var t,a=m(e.nodes);try{for(a.s();!(t=a.n()).done;){var n=t.value.point;n.x=n.x-r.x,n.y=n.y-r.z}}catch(e){a.e(e)}finally{a.f()}e.nodes.length>2&&E.generateSpline(e),d.calculateExtentCubicSpline(e)}},{key:"centraliseExtent",value:function(e){var r={};r.x=e.max.x-e.min.x,r.y=e.max.y-e.min.y,r.z=e.max.z-e.min.z,e.min.x=-r.x/2,e.max.x=r.x/2,e.min.y=-r.y/2,e.max.y=r.y/2,e.min.z=-r.z/2,e.max.z=r.z/2}}]),e}(),p={TOP_HEAD:1,CHIN:2,NAPE:3,NAPE_INTERNAL:4,NAPE_LEVEL:5,NECK_INTERNAL:6,FRONT_NECK:7,LEFT_SIDE_NECK:8,RIGHT_SIDE_NECK:9,LEFT_SHOULDER:10,RIGHT_SHOULDER:11,LEFT_ARMPIT:12,RIGHT_ARMPIT:13,ARMPIT_INTERNAL:14,CHEST_INTERNAL:15,CHEST_LEVEL:16,LOW_CHEST_LEVEL:17,LOW_CHEST_INTERNAL:18,LEFT_NIPPLE:19,RIGHT_NIPPLE:20,REAR_WAIST:21,FRONT_WAIST:22,WAIST_INTERNAL:23,WAIST_LEVEL:24,TOP_HIP_LEVEL:25,SEAT_PROMINENCE:26,HIP_INTERNAL:27,HIP_LEVEL:28,CROTCH:29,FRONT_CHEST:31,FRONT_LOW_CHEST:32,MID_WAIST_INTERNAL:33,MID_WAIST_LEVEL:34,BACK_PROMINENCE:35,ABDOMEN_PROMINENCE:36,BACK_ARCH:37,LOWER_BUTTOCK:38,UPPER_ABDOMEN:39,LOWER_ABDOMEN:40,LEFT_SIDE_WAIST_BILATERAL:41,RIGHT_SIDE_WAIST_BILATERAL:42,SHOULDER_INTERNAL:43,LEFT_ARMPIT_INTERNAL:46,RIGHT_ARMPIT_INTERNAL:47,REAR_MID_WAIST:48,FRONT_MID_WAIST:49,LEFT_TOP_THIGH_INTERNAL:50,RIGHT_TOP_THIGH_INTERNAL:51,LEFT_TOP_THIGH_LEVEL:52,RIGHT_TOP_THIGH_LEVEL:53,LEFT_KNEE_INTERNAL:54,RIGHT_KNEE_INTERNAL:55,LEFT_KNEE_LEVEL:56,RIGHT_KNEE_LEVEL:57,LEFT_CALF:58,RIGHT_CALF:59,LEFT_CALF_LEVEL:60,RIGHT_CALF_LEVEL:61,LEFT_MINIMUM_LEG_INTERNAL:62,RIGHT_MINIMUM_LEG_INTERNAL:63,LEFT_MINIMUM_LEG_LEVEL:64,RIGHT_MINIMUM_LEG_LEVEL:65,LEFT_ANKLE_INTERNAL:66,RIGHT_ANKLE_INTERNAL:67,LEFT_ANKLE_LEVEL:68,RIGHT_ANKLE_LEVEL:69,LEFT_FLOOR:70,RIGHT_FLOOR:71,LEFT_FLOOR_LEVEL:72,RIGHT_FLOOR_LEVEL:73,LEFT_MID_THIGH_LEVEL:75,RIGHT_MID_THIGH_LEVEL:76,LEFT_TOP_ARM_INTERNAL:100,RIGHT_TOP_ARM_INTERNAL:101,LEFT_TOP_ARM_LEVEL:102,RIGHT_TOP_ARM_LEVEL:103,LEFT_ELBOW:104,RIGHT_ELBOW:105,LEFT_ARMCREASE:106,RIGHT_ARMCREASE:107,LEFT_ELBOW_INTERNAL:108,RIGHT_ELBOW_INTERNAL:109,LEFT_WRIST_INNER:110,RIGHT_WRIST_INNER:111,LEFT_WRIST_OUTER:112,RIGHT_WRIST_OUTER:113,LEFT_WRIST_INTERNAL:114,RIGHT_WRIST_INTERNAL:115,LEFT_WRIST_LEVEL:116,RIGHT_WRIST_LEVEL:117,LEFT_HAND:118,RIGHT_HAND:119,CWALL_L_HIGH_CHEST:1501,CWALL_L_ARMPIT:1502,CWALL_L_CHEST:1503,CWALL_L_LOW_CHEST:1504,CWALL_L_WAIST:1505,CWALL_MID_HIGH_CHEST:1506,CWALL_MID_ARMPIT:1507,CWALL_MID_CHEST:1508,CWALL_MID_LOW_CHEST:1509,CWALL_MID_WAIST:1510,CWALL_R_HIGH_CHEST:1511,CWALL_R_ARMPIT:1512,CWALL_R_CHEST:1513,CWALL_R_LOW_CHEST:1514,CWALL_R_WAIST:1515,properties:{1:{name:"Top of head",spline:!0},2:{name:"Chin"},3:{name:"Nape"},4:{name:"Nape internal"},5:{name:"Nape level"},6:{name:"Neck internal",important:!0,spline:!0},7:{name:"Front neck",deform:!0},8:{name:"Left side neck"},9:{name:"Right side neck"},10:{name:"Left shoulder",deform:!0},11:{name:"Right shoulder",deform:!0},12:{name:"Left armpit",important:!0,partition:!0},13:{name:"Right armpit",important:!0,partition:!0},14:{name:"Armpit internal"},15:{name:"Chest internal"},16:{name:"Chest level",deform:!0},17:{name:"Low chest level",important:!0,deform:!0},18:{name:"Low chest internal"},19:{name:"Left nipple"},20:{name:"Right nipple"},21:{name:"Rear waist"},22:{name:"Front waist"},23:{name:"Waist internal",spline:!0},24:{name:"Waist level",important:!0},25:{name:"Top hip level"},26:{name:"Seat prominence",deform:!0},27:{name:"Hip internal",deform:!0},28:{name:"Hip level",important:!0},29:{name:"Crotch",important:!0,partition:!0},31:{name:"Front chest"},32:{name:"Front low chest"},33:{name:"Mid waist internal"},34:{name:"Mid waist level"},35:{name:"Back prominence"},36:{name:"Abdomen prominence"},37:{name:"Back arch"},38:{name:"Lower buttock"},39:{name:"Upper abdomen"},40:{name:"Lower abdomen"},41:{name:"Left side waist bilateral"},42:{name:"Right side waist bilateral"},43:{name:"Shoulder internal"},46:{name:"Left armpit internal"},47:{name:"Right armpit internal"},48:{name:"Rear mid waist"},49:{name:"Front mid waist"},50:{name:"Left top thigh internal",spline:!0},51:{name:"Right top thigh internal",spline:!0},52:{name:"Left top thigh level"},53:{name:"Right top thigh level"},54:{name:"Left knee internal",spline:!0},55:{name:"Right knee internal",spline:!0},56:{name:"Left knee level",important:!0},57:{name:"Right knee level",important:!0},58:{name:"Left calf"},59:{name:"Right calf"},60:{name:"Left calf level"},61:{name:"Right calf level"},62:{name:"Left minimum leg internal"},63:{name:"Right minimum leg internal"},64:{name:"Left minimum leg level"},65:{name:"Right minimum leg level"},66:{name:"Left ankle internal",spline:!0},67:{name:"Right ankle internal",spline:!0},68:{name:"Left ankle level",important:!0},69:{name:"Right ankle level",important:!0},70:{name:"Left floor",spline:!0},71:{name:"Right floor",spline:!0},72:{name:"Left floor level"},73:{name:"Right floor level"},75:{name:"Left mid thigh level"},76:{name:"Right mid thigh level"},100:{name:"Left top arm internal",spline:!0},101:{name:"Right top arm internal",spline:!0},102:{name:"Left top arm level"},103:{name:"Right top arm level"},104:{name:"Left elbow",important:!0},105:{name:"Right elbow",important:!0},106:{name:"Left armcrease"},107:{name:"Right armcrease"},108:{name:"Left elbow internal",spline:!0},109:{name:"Right elbow internal",spline:!0},110:{name:"Left wrist inner",important:!0},111:{name:"Right wrist inner",important:!0},112:{name:"Left wrist outer"},113:{name:"Right wrist outer"},114:{name:"Left wrist internal",deform:!0,spline:!0},115:{name:"Right wrist internal",deform:!0,spline:!0},116:{name:"Left wrist level"},117:{name:"Right wrist level"},118:{name:"Left hand",spline:!0},119:{name:"Right hand",spline:!0},1501:{name:"Chestwall left high chest"},1502:{name:"Chestwall left armpit"},1503:{name:"Chestwall left chest"},1504:{name:"Chestwall left low chest"},1505:{name:"Chestwall left waist"},1506:{name:"Chestwall mid high chest"},1507:{name:"Chestwall mid armpit"},1508:{name:"Chestwall mid chest"},1509:{name:"Chestwall mid low chest"},1510:{name:"Chestwall mid waist"},1511:{name:"Chestwall right high chest"},1512:{name:"Chestwall right armpit"},1513:{name:"Chestwall right chest"},1514:{name:"Chestwall right low chest"},1515:{name:"Chestwall right waist"}},fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))[0]}};function S(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}const A=function(){function e(){a(this,e)}return i(e,null,[{key:"getLandmarkByRef",value:function(e,r){var t,a=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return S(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?S(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}(e.landmarks);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(p[n.id]==r)return n}}catch(e){a.e(e)}finally{a.f()}return null}}]),e}(),I={TORSO_TOPHEAD:1,TORSO_FRONT_NECK:2,TORSO_NAPE:3,TORSO_NECK:4,TORSO_NECK_PREPROCESS:5,TORSO_NECK_UPPER:6,TORSO_NECK_LOWER:7,TORSO_SHOULDER_PREPROCESS:8,TORSO_SHOULDER:9,TORSO_ARMPIT_LOWER:10,TORSO_ARMPIT_UPPER:11,TORSO_ARMPIT_PREPROCESS:12,TORSO_ARMPIT:13,TORSO_LOW_CHEST_PREPROCESS:14,TORSO_LOW_CHEST:15,TORSO_CHEST_PREPROCESS:16,TORSO_CHEST:17,TORSO_WAIST_PREPROCESS:18,TORSO_WAIST:19,TORSO_WAIST_LOWER:20,TORSO_WAIST_UPPER:21,TORSO_SEAT_PROMINENCE:22,TORSO_HIP_PREPROCESS:23,TORSO_HIP:24,TORSO_HIP_LOWER:25,TORSO_HIP_UPPER:26,TORSO_CROTCH:27,TORSO_CROTCH_ARMPIT_THIRD:28,CHESTWALL_ARMPIT_PREPROCESS:29,CHESTWALL_CHEST_PREPROCESS:30,CHESTWALL_LOW_CHEST_PREPROCESS:31,CHESTWALL_WAIST_PREPROCESS:32,CHESTWALL_HIGH_CHEST_PREPROCESS:33,CHESTWALL_ARMPIT:34,CHESTWALL_CHEST:35,CHESTWALL_LOW_CHEST:36,CHESTWALL_WAIST:37,CHESTWALL_HIGH_CHEST:38,LEFTLEG_FLOOR:39,LEFTLEG_MINIMUM_LEG:40,LEFTLEG_ANKLE:41,LEFTLEG_ANKLE_LOWER:42,LEFTLEG_ANKLE_UPPER:43,LEFTLEG_KNEE:44,LEFTLEG_KNEE_LOWER:45,LEFTLEG_KNEE_UPPER:46,LEFTLEG_THIGH:47,RIGHTLEG_FLOOR:48,RIGHTLEG_MINIMUM_LEG:49,RIGHTLEG_ANKLE:50,RIGHTLEG_ANKLE_LOWER:51,RIGHTLEG_ANKLE_UPPER:52,RIGHTLEG_KNEE:53,RIGHTLEG_KNEE_LOWER:54,RIGHTLEG_KNEE_UPPER:55,RIGHTLEG_THIGH:56,LEFTARM_TOPARM:57,LEFTARM_ELBOW:58,LEFTARM_ELBOW_UPPER:59,LEFTARM_ELBOW_LOWER:60,LEFTARM_WRIST:61,LEFTARM_HAND:62,RIGHTARM_TOPARM:63,RIGHTARM_ELBOW:64,RIGHTARM_ELBOW_UPPER:65,RIGHTARM_ELBOW_LOWER:66,RIGHTARM_WRIST:67,RIGHTARM_HAND:68,fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))[0]}};function v(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}const O=function(){function e(){a(this,e)}return i(e,null,[{key:"layerMarker",value:function(e,r){if(null!=e.layerMarkers){var t,a=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return v(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}(e.layerMarkers);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(I[n.layerNameType]==r)return n}}catch(e){a.e(e)}finally{a.f()}}return null}},{key:"updateLayerMarker",value:function(e,r,t){var a=this.layerMarker(e,r);null!=a?a.value=t:(a={layerNameType:I.fromInt(r),value:t},null==e.layerMarkers&&(e.layerMarkers=[]),e.layerMarkers.push(a))}},{key:"updateLayerMarkerDouble",value:function(e,r,t,a){var n=this.getDoubleLayerByMarker(e,t,a);this.updateLayerMarker(e,r,n)}},{key:"layerAbove",value:function(e,r){var t=this.layerMarker(e,r);if(null==t)return null;var a=t.getValue()+1;return e.layers[a]}},{key:"getDoubleLayerByMarker",value:function(r,t,a){var n=e.layerMarker(r,t),i=e.layerMarker(r,a);return y.getDoubleLayer(r,n.value,i.value)}},{key:"updateLayerMarkerAbove",value:function(e,r,t){this.updateLayerMarker(e,r,this.layerMarkerValue(e,t)+1)}},{key:"layerMarkerValue",value:function(e,r){var t=this.layerMarker(e,r);return null==t?null:t.value}}]),e}();function g(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}const x=function(){function e(){a(this,e)}return i(e,null,[{key:"createSplineRegions",value:function(e,r,t){var a,n=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return g(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?g(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}(e.bodyParts);try{for(n.s();!(a=n.n()).done;){var i=a.value;this.createSplineRegionsBodypart(e,i,r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"createSplineRegionsBodypart",value:function(e,r,t){t?this.layerRefsPreProcessing(e,r):this.layerRefs(e,r);var a=[];if(s[r.id]==s.TORSO){var n=O.layerMarker(r,I.TORSO_NECK_UPPER),i=O.layerMarker(r,I.TORSO_TOPHEAD),o=O.layerMarker(r,I.TORSO_ARMPIT_UPPER),l=O.layerMarker(r,I.TORSO_NECK_LOWER),u=O.layerMarker(r,I.TORSO_WAIST_UPPER),_=O.layerMarker(r,I.TORSO_ARMPIT_LOWER),L=O.layerMarker(r,I.TORSO_HIP_UPPER),y=O.layerMarker(r,I.TORSO_WAIST_LOWER),R=O.layerMarker(r,I.TORSO_CROTCH),E=O.layerMarker(r,I.TORSO_CROTCH_ARMPIT_THIRD);a.push(this.initialiseSplineRegion(e,r,14,n,i)),a.push(this.initialiseSplineRegion(e,r,8,o,l)),a.push(this.initialiseSplineRegion(e,r,3,u,_)),a.push(this.initialiseSplineRegion(e,r,4,L,y)),a.push(this.initialiseSplineRegion(e,r,5,R,L)),a.push(this.initialiseSplineRegion(e,r,36,E,o))}if(s[r.id]==s.CHEST_WALL)if(t){var T=O.layerMarker(r,I.CHESTWALL_WAIST_PREPROCESS),f=O.layerMarker(r,I.CHESTWALL_ARMPIT_PREPROCESS);a.push(this.initialiseSplineRegion(e,r,3,T,f))}else{var d=O.layerMarker(r,I.CHESTWALL_WAIST),m=O.layerMarker(r,I.CHESTWALL_ARMPIT);a.push(this.initialiseSplineRegion(e,r,3,d,m))}if(s[r.id]==s.LEFT_LEG){var c=O.layerMarker(r,I.LEFTLEG_KNEE_UPPER),h=O.layerMarker(r,I.LEFTLEG_THIGH),p=O.layerMarker(r,I.LEFTLEG_ANKLE_UPPER),S=O.layerMarker(r,I.LEFTLEG_KNEE_LOWER),A=O.layerMarker(r,I.LEFTLEG_FLOOR),v=O.layerMarker(r,I.LEFTLEG_ANKLE_LOWER);a.push(this.initialiseSplineRegion(e,r,6,c,h)),a.push(this.initialiseSplineRegion(e,r,7,p,S)),a.push(this.initialiseSplineRegion(e,r,13,A,v))}if(s[r.id]==s.RIGHT_LEG){var g=O.layerMarker(r,I.RIGHTLEG_KNEE_UPPER),x=O.layerMarker(r,I.RIGHTLEG_THIGH),N=O.layerMarker(r,I.RIGHTLEG_ANKLE_UPPER),H=O.layerMarker(r,I.RIGHTLEG_KNEE_LOWER),k=O.layerMarker(r,I.RIGHTLEG_FLOOR),M=O.layerMarker(r,I.RIGHTLEG_ANKLE_LOWER);a.push(this.initialiseSplineRegion(e,r,6,g,x)),a.push(this.initialiseSplineRegion(e,r,7,N,H)),a.push(this.initialiseSplineRegion(e,r,13,k,M))}if(s[r.id]==s.LEFT_ARM){var P=O.layerMarker(r,I.LEFTARM_ELBOW_UPPER),F=O.layerMarker(r,I.LEFTARM_TOPARM),G=O.layerMarker(r,I.LEFTARM_WRIST),b=O.layerMarker(r,I.LEFTARM_ELBOW_LOWER);a.push(this.initialiseSplineRegion(e,r,15,P,F)),a.push(this.initialiseSplineRegion(e,r,18,G,b))}if(s[r.id]==s.RIGHT_ARM){var C=O.layerMarker(r,I.RIGHTARM_ELBOW_UPPER),W=O.layerMarker(r,I.RIGHTARM_TOPARM),B=O.layerMarker(r,I.RIGHTARM_WRIST),D=O.layerMarker(r,I.RIGHTARM_ELBOW_LOWER);a.push(this.initialiseSplineRegion(e,r,15,C,W)),a.push(this.initialiseSplineRegion(e,r,18,B,D))}a=a.map((function(e){return e})),r.splineRegions=a}},{key:"initialiseSplineRegion",value:function(e,r,t,a,n){var i=a.value,o=n.value;if(i>=0&&o>=i){var l={id:t,startLayer:i,endLayer:o},u=null;if(5==t){var s=O.layerMarker(r,I.TORSO_HIP_LOWER);u=r.layers[s.value]}else if(36==t){var _=O.layerMarker(r,I.TORSO_CROTCH_ARMPIT_THIRD);u=r.layers[_.value]}else if(8==t){var L=O.layerMarker(r,I.TORSO_NECK_LOWER);u=r.layers[L.value]}return this.setSamplingParameters(l,e.normaliseResolution),this.setCentroids(e,l,r.id,t,u),l}return console.error("create spline region: start layer and end layer bad"),null}},{key:"initialiseCentroid",value:function(){return{left:{x:0,y:0},right:{x:0,y:0}}}},{key:"layerRefs",value:function(e,r){if(s[r.id]==s.LEFT_LEG&&(O.updateLayerMarker(r,I.LEFTLEG_THIGH,r.layers.length-1),O.updateLayerMarker(r,I.LEFTLEG_FLOOR,0),O.updateLayerMarkerDouble(r,I.LEFTLEG_ANKLE_LOWER,I.LEFTLEG_FLOOR,I.LEFTLEG_THIGH),O.updateLayerMarkerAbove(r,I.LEFTLEG_ANKLE_UPPER,I.LEFTLEG_ANKLE_LOWER),O.updateLayerMarker(r,I.LEFTLEG_KNEE_LOWER,O.getDoubleLayerByMarker(r,I.LEFTLEG_ANKLE_UPPER,I.LEFTLEG_THIGH)),O.updateLayerMarkerAbove(r,I.LEFTLEG_KNEE_UPPER,I.LEFTLEG_KNEE_LOWER)),s[r.id]==s.RIGHT_LEG&&(O.updateLayerMarker(r,I.RIGHTLEG_THIGH,r.layers.length-1),O.updateLayerMarker(r,I.RIGHTLEG_FLOOR,0),O.updateLayerMarkerDouble(r,I.RIGHTLEG_ANKLE_LOWER,I.RIGHTLEG_FLOOR,I.RIGHTLEG_THIGH),O.updateLayerMarkerAbove(r,I.RIGHTLEG_ANKLE_UPPER,I.RIGHTLEG_ANKLE_LOWER),O.updateLayerMarkerDouble(r,I.RIGHTLEG_KNEE_LOWER,I.RIGHTLEG_ANKLE_UPPER,I.RIGHTLEG_THIGH),O.updateLayerMarkerAbove(r,I.RIGHTLEG_KNEE_UPPER,I.RIGHTLEG_KNEE_LOWER)),s[r.id]==s.LEFT_ARM&&(O.updateLayerMarker(r,I.LEFTARM_TOPARM,r.layers.length-1),O.updateLayerMarker(r,I.LEFTARM_HAND,0),O.updateLayerMarkerDouble(r,I.LEFTARM_ELBOW_LOWER,I.LEFTARM_HAND,I.LEFTARM_TOPARM),O.updateLayerMarkerAbove(r,I.LEFTARM_ELBOW_UPPER,I.LEFTARM_ELBOW_LOWER),O.updateLayerMarker(r,I.LEFTARM_WRIST,0)),s[r.id]==s.RIGHT_ARM&&(O.updateLayerMarker(r,I.RIGHTARM_TOPARM,r.layers.length-1),O.updateLayerMarker(r,I.RIGHTARM_HAND,0),O.updateLayerMarkerDouble(r,I.RIGHTARM_ELBOW_LOWER,I.RIGHTARM_HAND,I.RIGHTARM_TOPARM),O.updateLayerMarkerAbove(r,I.RIGHTARM_ELBOW_UPPER,I.RIGHTARM_ELBOW_LOWER),O.updateLayerMarker(r,I.RIGHTARM_WRIST,0)),s[r.id]==s.TORSO||r.id==s.CHEST_WALL){var t=A.getLandmarkByRef(e,p.CHEST_LEVEL),a=A.getLandmarkByRef(e,p.LOW_CHEST_LEVEL),n=A.getLandmarkByRef(e,p.LEFT_SHOULDER),i=A.getLandmarkByRef(e,p.RIGHT_SHOULDER);O.updateLayerMarker(r,I.TORSO_TOPHEAD,r.layers.length-1),O.updateLayerMarker(r,I.TORSO_CROTCH,0),O.updateLayerMarkerDouble(r,I.TORSO_HIP_LOWER,I.TORSO_CROTCH,I.TORSO_TOPHEAD),O.updateLayerMarkerAbove(r,I.TORSO_HIP_UPPER,I.TORSO_HIP_LOWER),O.updateLayerMarkerDouble(r,I.TORSO_WAIST_LOWER,I.TORSO_HIP_UPPER,I.TORSO_TOPHEAD),O.updateLayerMarkerAbove(r,I.TORSO_WAIST_UPPER,I.TORSO_WAIST_LOWER),O.updateLayerMarkerDouble(r,I.TORSO_ARMPIT_LOWER,I.TORSO_WAIST_UPPER,I.TORSO_TOPHEAD),O.updateLayerMarkerAbove(r,I.TORSO_ARMPIT_UPPER,I.TORSO_ARMPIT_LOWER),O.updateLayerMarkerDouble(r,I.TORSO_NECK_LOWER,I.TORSO_ARMPIT_UPPER,I.TORSO_TOPHEAD),O.updateLayerMarkerAbove(r,I.TORSO_NECK_UPPER,I.TORSO_NECK_LOWER);var o=O.layerMarker(r,I.TORSO_ARMPIT_LOWER);if(1==e.sex){var l=O.layerMarker(r,I.TORSO_WAIST_UPPER),u=l.value+.8*(o.value-l.value),_=l.value+.8*(u-l.value);O.updateLayerMarker(r,I.TORSO_CHEST,u),O.updateLayerMarker(r,I.TORSO_LOW_CHEST,_)}else O.updateLayerMarker(r,I.TORSO_CHEST,y.getNearestLayerId(r,t)),O.updateLayerMarker(r,I.TORSO_LOW_CHEST,y.getNearestLayerId(r,a));null!=n&&null!=i&&O.updateLayerMarker(r,I.TORSO_SHOULDER,y.getNearestLayerID(r,General.mean2numbers(n.y,i.y)));var L=Math.floor(.333*o.value);O.updateLayerMarker(r,I.TORSO_CROTCH_ARMPIT_THIRD,L)}if(s[r.id]==s.CHEST_WALL){var R=y.getBodypartByRef(e,s.TORSO),E=O.layerMarker(R,I.TORSO_LOW_CHEST),T=O.layerMarker(R,I.TORSO_WAIST_UPPER),f=O.layerMarker(R,I.TORSO_ARMPIT_LOWER),d=O.layerMarker(R,I.TORSO_NECK_LOWER),m=O.layerMarker(R,I.TORSO_ARMPIT_UPPER);O.updateLayerMarker(r,I.CHESTWALL_WAIST,0),O.updateLayerMarker(r,I.CHESTWALL_LOW_CHEST,E.value-T.value),O.updateLayerMarker(r,I.CHESTWALL_ARMPIT,f.value-T.value),O.updateLayerMarker(r,I.CHESTWALL_HIGH_CHEST,(d.value+m.value)/2-T.value);var c=O.layerMarker(r,I.CHESTWALL_ARMPIT),h=O.layerMarker(r,I.CHESTWALL_LOW_CHEST);O.updateLayerMarker(r,I.CHESTWALL_CHEST,(5*c.value+5*h.value)/10)}}},{key:"setCentroids",value:function(e,r,t,a,n){var i,o,l,u,_,L,y,R,E,T,f,d,m,c,h,S,I,v,O,g,x,N,H,k=this.initialiseCentroid(),M=this.initialiseCentroid();switch(a){case 6:t==s.LEFT_LEG?(o=A.getLandmarkByRef(e,p.LEFT_TOP_THIGH_INTERNAL),i=A.getLandmarkByRef(e,p.LEFT_KNEE_INTERNAL)):(o=A.getLandmarkByRef(e,p.RIGHT_TOP_THIGH_INTERNAL),i=A.getLandmarkByRef(e,p.RIGHT_KNEE_INTERNAL)),k.left.x=i.x,k.left.y=i.z,k.right.x=i.x,k.right.y=i.z,M.left.x=o.x,M.left.y=o.z,M.right.x=o.x,M.right.y=o.z;break;case 7:t==s.LEFT_LEG?(u=A.getLandmarkByRef(e,p.LEFT_ANKLE_INTERNAL),i=A.getLandmarkByRef(e,p.LEFT_KNEE_INTERNAL)):(u=A.getLandmarkByRef(e,p.RIGHT_ANKLE_INTERNAL),i=A.getLandmarkByRef(e,p.RIGHT_KNEE_INTERNAL)),k.left.x=u.x,k.left.y=u.z,k.right.x=u.x,k.right.y=u.z,M.left.x=i.x,M.left.y=i.z,M.right.x=i.x,M.right.y=i.z;break;case 13:t==s.LEFT_LEG?(u=A.getLandmarkByRef(e,p.LEFT_ANKLE_INTERNAL),l=A.getLandmarkByRef(e,p.LEFT_FLOOR)):(u=A.getLandmarkByRef(e,p.RIGHT_ANKLE_INTERNAL),l=A.getLandmarkByRef(e,p.RIGHT_FLOOR)),k.left.x=l.x,k.left.y=l.z,k.right.x=l.x,k.right.y=l.z,M.left.x=u.x,M.left.y=u.z,M.right.x=u.x,M.right.y=u.z;break;case 5:y=A.getLandmarkByRef(e,p.HIP_INTERNAL),_=A.getLandmarkByRef(e,p.LEFT_TOP_THIGH_INTERNAL),L=A.getLandmarkByRef(e,p.RIGHT_TOP_THIGH_INTERNAL);var P=n;k.left.x=_.x,k.left.y=_.z,k.right.x=L.x,k.right.y=L.z,M.left.x=.75*P.extent.min.x+.25*P.extent.max.x,M.left.y=y.z,M.right.x=.25*P.extent.min.x+.75*P.extent.max.x,M.right.y=y.z;break;case 4:y=A.getLandmarkByRef(e,p.HIP_INTERNAL),E=A.getLandmarkByRef(e,p.WAIST_INTERNAL),k.left.x=y.x,k.left.y=y.z,k.right.x=y.x,k.right.y=y.z,M.left.x=E.x,M.left.y=E.z,M.right.x=E.x,M.right.y=E.z;break;case 3:T=A.getLandmarkByRef(e,p.LEFT_ARMPIT),f=A.getLandmarkByRef(e,p.RIGHT_ARMPIT),R={x:(T.x+f.x)/2,z:(T.z+f.z)/2},E=A.getLandmarkByRef(e,p.WAIST_INTERNAL),k.left.x=E.x,k.left.y=E.z,k.right.x=E.x,k.right.y=E.z,M.left.x=R.x,M.left.y=R.z,M.right.x=R.x,M.right.y=R.z;break;case 36:T=A.getLandmarkByRef(e,p.LEFT_ARMPIT),f=A.getLandmarkByRef(e,p.RIGHT_ARMPIT),R={x:(T.x+f.x)/2,z:(T.z+f.z)/2};var F=n;k.left.x=F.extent.mid.x,k.left.y=F.extent.mid.z,k.right.x=k.left.x,k.right.y=k.left.y,M.left.x=R.x,M.left.y=R.z,M.right.x=M.left.x,M.right.y=M.left.y;break;case 8:d={x:0,y:0},m={x:0,y:0},T=A.getLandmarkByRef(e,p.LEFT_ARMPIT_INTERNAL),f=A.getLandmarkByRef(e,p.RIGHT_ARMPIT_INTERNAL),h=A.getLandmarkByRef(e,p.NECK_INTERNAL);var G=n;G.extent.max.x-G.extent.min.x<12/(.6-.4)?(H=(G.extent.max.x+G.extent.min.x)/2,d.x=H-6,m.x=H+6):(d.x=.6*G.extent.min.x+.4*G.extent.max.x,m.x=.4*G.extent.min.x+.6*G.extent.max.x),S=A.getLandmarkByRef(e,p.LEFT_TOP_ARM_INTERNAL);var b=null!=T?T.x:0,C=null!=T?T.z:0,W=null!=f?f.x:0,B=null!=f?f.z:0;null!=S?(O=General.mean2numbers(S.x,b),x=Math.ceil(.65*S.z+.35*C)):(O=b,x=C),null!=(S=A.getLandmarkByRef(e,p.RIGHT_TOP_ARM_INTERNAL))?(g=General.mean2numbers(S.x,W),N=Math.ceil(.65*S.z+.35*B)):(g=W,N=B),k.left.x=O,k.left.y=x,k.right.x=g,k.right.y=N,M.left.x=d.x,M.left.y=h.z,M.right.x=m.x,M.right.y=h.z;break;case 14:c=A.getLandmarkByRef(e,p.TOP_HEAD),h=A.getLandmarkByRef(e,p.NECK_INTERNAL),k.left.x=h.x,k.left.y=h.z,k.right.x=h.x,k.right.y=h.z,M.left.x=c.x,M.left.y=c.z,M.right.x=c.x,M.right.y=c.z;break;case 15:t==s.LEFT_ARM?(S=A.getLandmarkByRef(e,p.LEFT_TOP_ARM_INTERNAL),v=A.getLandmarkByRef(e,p.LEFT_ELBOW_INTERNAL)):(S=A.getLandmarkByRef(e,p.RIGHT_TOP_ARM_INTERNAL),v=A.getLandmarkByRef(e,p.RIGHT_ELBOW_INTERNAL)),k.left.x=v.x,k.left.y=v.z,k.right.x=v.x,k.right.y=v.z,M.left.x=S.x,M.left.y=S.z,M.right.x=S.x,M.right.y=S.z;break;case 18:t==s.LEFT_ARM?(I=A.getLandmarkByRef(e,p.LEFT_WRIST_INTERNAL),v=A.getLandmarkByRef(e,p.LEFT_ELBOW_INTERNAL)):(I=A.getLandmarkByRef(e,p.RIGHT_WRIST_INTERNAL),v=A.getLandmarkByRef(e,p.RIGHT_ELBOW_INTERNAL)),k.left.x=I.x,k.left.y=I.z,k.right.x=I.x,k.right.y=I.z,M.left.x=v.x,M.left.y=v.z,M.right.x=v.x,M.right.y=v.z}r.start=k,r.end=M}},{key:"setSamplingParameters",value:function(e,r){switch(e.id){case 6:case 7:1==r?(e.noRadial=5,e.noLinear=0,e.noNormalisedLayers=16):2==r?(e.noRadial=7,e.noLinear=0,e.noNormalisedLayers=24):(e.noRadial=9,e.noLinear=0,e.noNormalisedLayers=32);break;case 13:1==r?(e.noRadial=5,e.noLinear=0,e.noNormalisedLayers=4):2==r?(e.noRadial=7,e.noLinear=0,e.noNormalisedLayers=6):(e.noRadial=9,e.noLinear=0,e.noNormalisedLayers=8);break;case 5:1==r?(e.noRadial=4,e.noLinear=8,e.noNormalisedLayers=5):2==r?(e.noRadial=6,e.noLinear=12,e.noNormalisedLayers=8):(e.noRadial=8,e.noLinear=16,e.noNormalisedLayers=10);break;case 4:case 3:1==r?(e.noRadial=8,e.noLinear=0,e.noNormalisedLayers=15):2==r?(e.noRadial=12,e.noLinear=0,e.noNormalisedLayers=24):(e.noRadial=16,e.noLinear=0,e.noNormalisedLayers=30);break;case 8:1==r?(e.noRadial=4,e.noLinear=6,e.noNormalisedLayers=16):2==r?(e.noRadial=6,e.noLinear=20,e.noNormalisedLayers=24):(e.noRadial=8,e.noLinear=12,e.noNormalisedLayers=32);break;case 14:1==r?(e.noRadial=7,e.noLinear=0,e.noNormalisedLayers=10):2==r?(e.noRadial=16,e.noLinear=0,e.noNormalisedLayers=15):(e.noRadial=14,e.noLinear=0,e.noNormalisedLayers=20);break;case 15:1==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=8):2==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=12):(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=16);break;case 18:1==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=12):2==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=18):(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=24);break;default:console.log("Using default Spline Region settings for "+e.toString()),e.noRadial=5,e.noLinear=5,e.noNormalisedLayers=24}}}]),e}(),N=24;function H(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return k(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?k(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}function k(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}const M=function(){function e(){a(this,e)}return i(e,null,[{key:"extractSilhouettesBody",value:function(e){var r,t=H(e.bodyParts);try{for(t.s();!(r=t.n()).done;){var a=r.value;this.extractSilhouettesBodypart(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"extractSilhouettesBodypart",value:function(e){e.frontSilhouette=this.extractFrontSilhouette(e),e.sideSilhouette=this.extractSideSilhouette(e)}},{key:"extractFrontSilhouette",value:function(e){var r=[];switch(e.id){case"LEFT_LEG":case"RIGHT_LEG":r.push(this.extractSilhouetteSegment(e,1,0,0,2,1,2)),r.push(this.extractSilhouetteSegment(e,2,0,0,2,2,2));break;case"LEFT_ARM":case"RIGHT_ARM":r.push(this.extractSilhouetteSegment(e,9,0,0,2,1,2)),r.push(this.extractSilhouetteSegment(e,10,0,0,2,2,2));break;case"TORSO":r.push(this.extractSilhouetteSegment(e,17,0,0,2,1,2)),r.push(this.extractSilhouetteSegment(e,20,0,0,2,2,2));break;default:return null}return r}},{key:"convertOutlineSegment",value:function(e,r){var t={};for(var a in e)t.push(this.frontSide(a,r));return t}},{key:"frontSide",value:function(e,r){var t={};return 1==r?(t.x=e.point.x,t.y=e.point.y,t.z=0):2==r&&(t.x=0,t.y=e.point.y,t.z=e.point.x),t}},{key:"extractSideSilhouette",value:function(e){var r=[];return s[e.id]==s.LEFT_LEG||s[e.id]==s.RIGHT_LEG?(r.push(this.extractSilhouetteSegment(e,6,0,0,2,2,1)),r.push(this.extractSilhouetteSegment(e,5,0,0,2,1,1))):s[e.id]==s.TORSO&&(r.push(this.extractSilhouetteSegment(e,N,0,0,2,2,1)),r.push(this.extractSilhouetteSegment(e,N,0,0,1,2,1)),r.push(this.extractSilhouetteSegment(e,25,0,0,2,1,1)),r.push(this.extractSilhouetteSegment(e,25,0,0,1,1,1))),r}},{key:"extractSilhouetteSegment",value:function(e,r,a,n,i,o,l){for(var u,s={},_={id:r,spline:{},outlineRefs:[]},L=e.layers.length-1;L>0&&(1!=i||L!=n);L--){var R=e.layers[L];s.x=2==o?2==l?R.extent.max.x:R.extent.max.z:2==l?R.extent.min.x:R.extent.min.z,s.y=R.y,E.addDistinctNode(_.spline,s,a)&&this.setOutlineRef(_,{x:s.x,y:s.y,z:R.extent.mid.z})}u=1==i?e.layers[n]:y.getBottomLayer(e),s.x=2==o?2==l?u.extent.max.x:u.extent.max.z:2==l?u.extent.min.x:u.extent.min.z,s.y=u.y;var T=E.addDistinctNode(_.spline,s,a);return T||(E.remove_end_node(_.spline),E.addDistinctNode(_.spline,s,a),t("ok")),T&&this.setOutlineRef(_,{x:s.x,y:s.y,z:u.extent.mid.z}),E.generateSpline(_.spline),_.spline.samplePoints=E.regeneratePointsOnSpline(_.spline,200,0,_.spline.nodes.length-1,!1),_}},{key:"getSilhouetteSplineSegment",value:function(e,r,t,a){var n=OutlineSegmentExist(e,r,t.frontTypeRearType);if(null==n)return console.error("Silhouette Spline Segment: Segment not found, segcode:"+r+", front side:"+t.frontTypeRearType),null;var i=E.getNearestNodeY(n.spline,t.maxLayer.y),o=E.getNearestNodeY(n.spline,t.minLayer.y);if(i>=0&&o>0&&i<n.spline.nodes.length-1){var l=new CubicSpline;return l.samplePoints=E.regeneratePointsOnSpline(n.spline,a,i,o,!1),l}return console.error("Silhouette Spline Segment: Min control index out of range, segcode:"+r+", minControlIndex:"+i+", maxControlIndex:"+o+", nNodes:"+n.spline.nodes.length),null}},{key:"OutlineSegmentExist",value:function(e,r,t){if(1==t){var a,n=H(e.frontSilhouette);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(i.id==r)return i}}catch(e){n.e(e)}finally{n.f()}}else{var o,l=H(e.sideSilhouette);try{for(l.s();!(o=l.n()).done;){var u=o.value;if(u.id==r)return u}}catch(e){l.e(e)}finally{l.f()}}return null}},{key:"setOutlineRef",value:function(e,r){e.outlineRefs.push(r)}},{key:"getOutlineRef",value:function(e,r){return e.outlineRefs[r]}},{key:"getFrontNeck_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.ARMPIT_INTERNAL,!1);if(null==a)return console.error("Required landmark not available"),null;var n=y.getTopLayer(t).y;r.minY=PointBean.proportion(a.y,n,.05),r.maxY=PointBean.proportion(a.y,n,.45),r.minLayer=y.getNearestLayer(t,r.minY),r.maxLayer=y.getNearestLayer(t,r.maxY);var i=getSilhouetteSplineSegment(t,N,r,100);return r.cubicSpline=i,r}},{key:"getChin_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.FRONT_NECK,!1);if(null==a)return console.error("Required landmark not available"),null;var n=y.getTopLayer(t).y;r.minY=PointBean.proportion(a.y,n,.05),r.maxY=PointBean.proportion(a.y,n,.4),r.minLayer=y.getNearestLayer(t,r.minY),r.maxLayer=y.getNearestLayer(t,r.maxY);var i=this.getSilhouetteSplineSegment(t,N,r,100);return r.cubicSpline=i,r}},{key:"getFrontChest_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.ARMPIT_INTERNAL,!1);if(null==a)return console.error("Required landmark not available"),null;var n=y.getBottomLayer(t).y;r.minY=a.y-.25*(a.y-n),r.maxY=a.y-.02*(a.y-n),r.minLayer=y.getNearestLayer(t,r.getMinY()),r.maxLayer=y.getNearestLayer(t,r.getMaxY());var i=this.getSilhouetteSplineSegment(t,N,r,100);return r.cubicSpline=i,r}},{key:"getShoulder_Silhouette",value:function(e,r){var t={frontSideRearType:1},a=y.getBodypartByRef(e,s.TORSO),n=LandmarkDetector.getLandmark(e,LandmarkType.ARMPIT_INTERNAL,!1),i=LandmarkDetector.getLandmark(e,LandmarkType.NECK_INTERNAL,!1);if(null==n||null==i)return console.error("Required landmark not available"),null;if(t.minY=PointBean.proportion(n.y,i.y,0),t.maxY=PointBean.proportion(n.y,i.y,1),t.minLayer=y.getNearestLayer(a,t.minY),t.maxLayer=y.getNearestLayer(a,t.maxY),1==r){var o=this.getSilhouetteSplineSegment(a,18,t,100);t.cubicSpline=o}else{var l=this.getSilhouetteSplineSegment(a,21,t,100);t.cubicSpline=l}return t}},{key:"getSideNeck_Silhouette",value:function(e,r){var t={frontSideRearType:1},a=y.getBodypartByRef(e,s.TORSO),n=LandmarkDetector.getLandmarkByRef(e,LandmarkType.LEFT_ARMPIT),i=LandmarkDetector.getLandmarkByRef(e,LandmarkType.RIGHT_ARMPIT);if(null==n||null==i)return console.error("Required landmark not available"),null;var o=General.max2int(n.y,i.y),l=y.getTopLayer(a).y;if(t.minY=PointBean.proportion(o,l,.2),t.maxY=PointBean.proportion(o,l,.8),t.minLayer=y.getNearestLayer(a,t.minY),t.maxLayer=y.getNearestLayer(a,t.maxY),1==r){var u=this.getSilhouetteSplineSegment(a,18,t,100);t.cubicSpline=u}else if(2==r){var _=this.getSilhouetteSplineSegment(a,21,t,100);t.cubicSpline=_}return t}},{key:"getFrontUnderChest_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.CHEST_LEVEL,!1);if(null==a)return console.error("Required landmark not available"),null;var n=y.getBottomLayer(t).y;r.minY=a.y-.3*(a.y-n),r.maxY=a.y-.05*(a.y-n),r.minLayer=y.getNearestLayer(t,r.minY),r.maxLayer=y.getNearestLayer(t,r.maxY);var i=this.getSilhouetteSplineSegment(t,N,r,100);return r.cubicSpline=i,r}},{key:"getInnerWrist_Silhouette",value:function(r,a){var n={frontSideRearType:1},i=s.RIGHT_ARM;1==a&&(s.LEFT_ARM,t("bodypartType"));var o=y.getBodypartByRef(r,i),l=e.OutlineSegmentExist(o,10,1).spline,u=E.NodeAtLength(l,90).point,_=E.NodeAtLength(l,65).point;n.minLayer=y.getNearestLayer(o,u.y),n.maxLayer=y.getNearestLayer(o,_.y);var L=this.getSilhouetteSplineSegment(o,10,n,100);return n.cubicSpline=L,n}},{key:"getArmCrease_Silhouette",value:function(e,r){var a={frontSideRearType:1},n=s.RIGHT_ARM;1==r&&(s.LEFT_ARM,t("bodypartType"));var i=y.getBodypartByRef(e,n);a.minLayer=y.getBottomLayer(i),a.maxLayer=y.getTopLayer(i);var o=this.getSilhouetteSplineSegment(i,10,a,100);return a.cubicSpline=o,a}},{key:"getBackArch_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.LEFT_ARMPIT,!1);if(null==a)return console.error("Required landmark not available"),null;var n=y.getBottomLayer(t).y;r.minY=n+.25*(a.y-n),r.maxY=n+.75*(a.y-n),r.minLayer=y.getNearestLayer(t,r.minY),r.maxLayer=y.getNearestLayer(t,r.maxY);var i=this.getSilhouetteSplineSegment(t,25,r,100);return r.cubicSpline=i,r}},{key:"getSeat_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.ARMPIT_INTERNAL,!1);if(null==a)return console.error("Required landmark not available"),null;var n=y.getBottomLayer(t).y;r.minY=n+.05*(a.y-n),r.maxY=n+.35*(a.y-n),r.minLayer=y.getNearestLayer(t,r.minY),r.maxLayer=y.getNearestLayer(t,r.maxY);var i=this.getSilhouetteSplineSegment(t,25,r,100);return r.cubicSpline=i,r}},{key:"getBackProminence_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.NECK_INTERNAL,!1),n=LandmarkDetector.getLandmark(e,LandmarkType.WAIST_LEVEL,!1);if(null==a||null==n)return console.error("Required landmark not available"),null;r.minLayer=y.getNearestLayer(t,n.y),r.maxLayer=y.getNearestLayer(t,a.y);var i=this.getSilhouetteSplineSegment(t,25,r,100);return r.cubicSpline=i,r}},{key:"getAbdomenProminence_Silhouette",value:function(e){var r={frontSideRearType:2},t=y.getBodypartByRef(e,s.TORSO),a=LandmarkDetector.getLandmark(e,LandmarkType.LOW_CHEST_LEVEL,!1),n=LandmarkDetector.getLandmark(e,LandmarkType.CROTCH,!1);if(null==a||null==n)return console.error("Required landmark not available"),null;r.minLayer=y.getNearestLayer(t,n.y),r.maxLayer=y.getNearestLayer(t,a.y);var i=this.getSilhouetteSplineSegment(t,N,r,100);return r.cubicSpline=i,r}}]),e}(),P={AXF_HEIGHT:1,AXF_NECK_GIRTH:2,AXF_CHEST_GIRTH:3,AXF_BUST_GIRTH:4,AXF_BUST_WIDTH:5,AXF_UNDER_BUST_GIRTH:6,AXF_LOW_CHEST_GIRTH:7,AXF_WAIST_GIRTH:8,AXF_TOP_HIP_GIRTH:9,AXF_SEAT_PROMINENCE_GIRTH:10,AXF_HIP_GIRTH:11,AXF_NAPE_HEIGHT:20,AXF_BUST_HEIGHT:21,AXF_UNDER_BUST_HEIGHT:22,AXF_WAIST_HEIGHT:23,AXF_HIP_HEIGHT:24,AXF_CROTCH_HEIGHT:25,AXF_FRONT_NECK_HEIGHT:26,AXF_TORSO_LENGTH_CROTCH_ARMPIT:27,AXF_NIPPLE_WIDTH:40,AXF_NAPE_TO_WAIST:41,AXF_THROUGH_RISE:42,AXF_NAPE_TO_LEFT_NIPPLE:43,AXF_NAPE_TO_RIGHT_NIPPLE:44,AXF_CENTRE_SHOULDER_TO_REAR_WAIST:45,AXF_BACK_SHOULDER_WIDTH:46,AXF_NAPE_TO_LEFT_SIDE_NECK:47,AXF_NAPE_TO_RIGHT_SIDE_NECK:48,AXF_LEFT_SIDE_NECK_TO_NIPPLE:49,AXF_RIGHT_SIDE_NECK_TO_NIPPLE:50,AXF_CENTRE_SHOULDER_TO_FRONT_WAIST:51,AXF_LEFT_THIGH_GIRTH:70,AXF_RIGHT_THIGH_GIRTH:71,AXF_LEFT_KNEE_GIRTH:72,AXF_RIGHT_KNEE_GIRTH:73,AXF_LEFT_CALF_GIRTH:74,AXF_RIGHT_CALF_GIRTH:75,AXF_LEFT_MINIMUM_LEG_GIRTH:76,AXF_RIGHT_MINIMUM_LEG_GIRTH:77,AXF_LEFT_ANKLE_GIRTH:78,AXF_RIGHT_ANKLE_GIRTH:79,AXF_LEFT_KNEE_HEIGHT:80,AXF_RIGHT_KNEE_HEIGHT:81,AXF_INSIDE_LEG:82,AXF_LEFT_MID_THIGH_GIRTH:83,AXF_RIGHT_MID_THIGH_GIRTH:84,AXF_LEFT_ARM_LENGTH:90,AXF_RIGHT_ARM_LENGTH:91,AXF_LEFT_UNDER_ARM_LENGTH:92,AXF_RIGHT_UNDER_ARM_LENGTH:93,AXF_LEFT_SHOULDER_SLOPE:94,AXF_RIGHT_SHOULDER_SLOPE:95,AXF_LEFT_UPPER_ARM_GIRTH:96,AXF_RIGHT_UPPER_ARM_GIRTH:97,AXF_LEFT_SHOULDER_TO_ELBOW:98,AXF_RIGHT_SHOULDER_TO_ELBOW:99,AXF_LEFT_ELBOW_TO_WRIST:100,AXF_RIGHT_ELBOW_TO_WRIST:101,AXF_LEFT_ARMPIT_TO_ARMCREASE:102,AXF_RIGHT_ARMPIT_TO_ARMCREASE:103,AXF_LEFT_ARMCREASE_TO_WRIST:104,AXF_RIGHT_ARMCREASE_TO_WRIST:105,AXF_LEFT_SHOULDER_LENGTH:106,AXF_RIGHT_SHOULDER_LENGTH:107,AXF_TORSO_LENGTH_CROTCH_ARMPIT_OLD:108,AXF_BUST_PROMINENCE_UPPER:200,AXF_BUST_PROMINENCE_LOWER:201,AXF_BUST_ANGLE:206,AXF_ABDOMEN_PROMINENCE_UPPER:210,AXF_ABDOMEN_PROMINENCE_LOWER:211,AXF_LEFT_FRONT_LATERAL_DEVIATION_UPPER:212,AXF_RIGHT_FRONT_LATERAL_DEVIATION_UPPER:213,AXF_LEFT_FRONT_LATERAL_DEVIATION_LOWER:214,AXF_RIGHT_FRONT_LATERAL_DEVIATION_LOWER:215,AXF_SEAT_PROMINENCE_UPPER:220,AXF_SEAT_PROMINENCE_LOWER:221,AXF_BACK_PROMINENCE_UPPER:230,AXF_BACK_PROMINENCE_LOWER:231,AXF_SIDE_BILATERAL_CROTCH:232,AXF_SIDE_BILATERAL_WAIST:233,AXF_SIDE_BILATERAL_ARMPIT:234,AXF_FRONT_BILATERAL_CROTCH:235,AXF_FRONT_BILATERAL_HIP:236,AXF_FRONT_BILATERAL_WAIST:237,AXF_FRONT_BILATERAL_ARMPIT:238,AXF_FRONT_BILATERAL_MIDHIP:239,AXF_BVI:240,AXF_TORSO_FRONT_CURVINESS:250,AXF_TORSO_REAR_CURVINESS:251,fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))}};function F(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}var G=function(){function e(){a(this,e)}return i(e,null,[{key:"readAxf",value:function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=new u(e),a={};return this.readAXFHeader(a,t),a.version<1.999&&(a.noHead=!0,a.noArms=!0),a.landmarks=this.readAXFLandmarks(t),a.version>1.999&&(a.referenceLocations=this.readAXFReferenceLocations(t)),this.readAXFPersonDetails(a,t),a.bodyParts=this.readAXFBodyParts(t,a.rawPointsDefined,a.surfaceDefined,a.colour,a.version),t.close(),this.load(a,r),a}},{key:"readAXFHeader",value:function(e,r){e.version=r.readFloat(),e.colour=r.javaBoolean(),e.sex=r.sexType(),e.yResolutionMM=r.readFloat(),e.xZResolutionMM=r.readFloat(),e.rawPointsDefined=r.javaBoolean(),e.surfaceDefined=r.javaBoolean(),e.normalisedPointsInLayer=r.javaBoolean(),e.normalisedLayersInRegion=r.javaBoolean()}},{key:"readAXFLandmarks",value:function(e){for(var r=[],t=e.readShort(),a=0;a<t;a++){var n=this.readAXFLandmark(e);r.push(n)}return r}},{key:"readAXFLandmark",value:function(e){var r=e.readShort(),t=p.fromInt(r);null==t&&console.log("No landmark type with id: "+r);var a={};return a.id=t,a.x=e.readShort(),a.y=e.readShort(),a.z=e.readShort(),a}},{key:"readAXFReferenceLocations",value:function(e){for(var r=[],t=e.readShort(),a=0;a<t;a++){var n={};n.id=e.readShort(),n.bodypartID=e.readShort(),n.layerId=e.readShort(),n.pointId=e.readInt(),n.visible=!1,r.push(n)}return r}},{key:"readAXFPersonDetails",value:function(e,r){var t=r.readShort();e.personDetails=[],e.measurements=[];for(var a=0;a<t;a++)e.personDetails.push(r.readShort());var n,i=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return F(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?F(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(l)throw i}}}}(e.personDetails);try{for(i.s();!(n=i.n()).done;)switch(n.value){case 2:case 3:break;case 1:for(var o=r.readShort(),l=0;l<o;l++)e.measurements.push(this.readAXFMeasurement(r));break;case 4:e.chestWallDefinition=this.readAXFChestWallParameters(r,e.version)}}catch(e){i.e(e)}finally{i.f()}}},{key:"readAXFMeasurement",value:function(e){var r=e.readShort(),t=P.fromInt(r);null==t&&log.severe("No measurement type with id: "+r);var a={};return a.id=t,a.value=e.readFloat(),a}},{key:"readAXFBodyParts",value:function(e,r,t,a,n){for(var i=[],o=e.readShort(),l=0;l<o;l++){var u=this.readAXFBodyPart(e,r,t,a,n);null!=u&&i.push(u)}return i}},{key:"readAXFBodyPart",value:function(e,r,a,n,i){var o=e.readShort(),l=s.fromInt(o);if(null==l)return console.error("Bodypart not recognised"),null;console.log("Reading bodypart id: "+s[l]+", name: "+l);var u=e.readShort(),_=e.readShort();console.log("Number of layers: "+_);for(var L=[],y=0;y<_;y++){var R=this.readAXFLayer(e,r,a,n,i);null==R?t("failedLayer"):L.push(R)}return{id:l,layerOffset:u,layers:L}}},{key:"readAXFLayer",value:function(e,r,t,a,n){var i={y:e.readShort()};if(1==r&&(i.pointLayer=this.readAXFPointLayer(e,i.y,a)),1==t){var o=this.readAXFSplineLayer(e,n,a);if(null==o)return console.error("Empty spline, layer ignored: y: "+i.y),null;i.splineLayer=o}return i}},{key:"readAXFSplineLayer",value:function(e,r,t){var a=this.readAXFCubicSpline(e,r,t);return null==a?null:{surface:a}}},{key:"readAXFCubicSpline",value:function(e,r,t){for(var a=[],n=e.readShort(),i=0;i<n;i++){var o={};1==r?o.point={x:e.readDouble(),y:e.readDouble()}:r>1.0001&&r<3.99999?o.point={x:e.readShort(),y:e.readShort()}:r>=3.99999&&(o.point={x:e.readFloat(),y:e.readFloat()}),o.colour=1==t?{x:e.readByte(),y:e.readByte(),z:e.readByte()}:{x:255,y:255,z:255},a.push(o)}if(!a.length)return null;var l={nodes:a};return E.generateSpline(l),l.surfaceMeasure=E.splineLength(l,0,l.nodes.length-1),l}},{key:"readAXFPointLayer",value:function(e,r,t){for(var a={},n=[],i=[],o=e.readShort(),l=0;l<o;l++){var u={},s={};u.x=e.readShort(),u.y=r,u.z=e.readShort(),1==t?(s.x=e.readByte(),s.y=e.readByte(),s.z=e.readByte()):(s.x=255,s.y=255,s.z=255),n.push(u),i.push(s)}return a.points=n,a.colours=i,a}},{key:"readAXFChestWallParameters",value:function(e,r){var t={};return t.useMidBust=e.javaBoolean(),r>3.01&&(t.regenerateArmpitPoints=e.javaBoolean()),t.threeLines=e.javaBoolean(),t.armpit_z_biasL=e.readDouble(),t.armpit_z_biasR=e.readDouble(),r>3&&(t.chest_z_biasL=e.readDouble(),t.chest_z_biasR=e.readDouble()),t.waist_z_biasL=e.readDouble(),t.waist_z_biasR=e.readDouble(),t.left_bust_x_bias=e.readDouble(),t.right_bust_x_bias=e.readDouble(),t.mid_bust_x_bias=e.readDouble(),t.z_midspline_adjust_highchest=e.readShort(),t.z_midspline_adjust_armpit=e.readShort(),t.z_midspline_adjust_bust=e.readShort(),t.z_midspline_adjust_underbust=e.readShort(),t.z_midspline_adjust_waist=e.readShort(),t.z_leftspline_adjust_highchest=e.readShort(),t.z_leftspline_adjust_armpit=e.readShort(),t.z_leftspline_adjust_bust=e.readShort(),t.z_leftspline_adjust_underbust=e.readShort(),t.z_leftspline_adjust_waist=e.readShort(),t.z_rightspline_adjust_highchest=e.readShort(),t.z_rightspline_adjust_armpit=e.readShort(),t.z_rightspline_adjust_bust=e.readShort(),t.z_rightspline_adjust_underbust=e.readShort(),t.z_rightspline_adjust_waist=e.readShort(),t.y_midspline_adjust_highchest=e.readShort(),t.y_midspline_adjust_armpit=e.readShort(),t.y_midspline_adjust_bust=e.readShort(),t.y_midspline_adjust_underbust=e.readShort(),t.y_midspline_adjust_waist=e.readShort(),t.y_leftspline_adjust_highchest=e.readShort(),t.y_leftspline_adjust_armpit=e.readShort(),t.y_leftspline_adjust_bust=e.readShort(),t.y_leftspline_adjust_underbust=e.readShort(),t.y_leftspline_adjust_waist=e.readShort(),t.y_rightspline_adjust_highchest=e.readShort(),t.y_rightspline_adjust_armpit=e.readShort(),t.y_rightspline_adjust_bust=e.readShort(),t.y_rightspline_adjust_underbust=e.readShort(),t.y_rightspline_adjust_waist=e.readShort(),t}},{key:"load",value:function(e,r){h.centraliseBody(e),M.extractSilhouettesBody(e),e.surfaceDefined&&(e.normaliseResolution=this.readAXFNormalisationResolution(e),x.createSplineRegions(e,!1,!1))}},{key:"readAXFNormalisationResolution",value:function(e){var r=y.getBodypartByRef(e,s.TORSO);if(null==r)return null;switch(y.getBottomLayer(r).splineLayer.surface.nodes.length){case 33:return 1;case 49:return 2;case 65:return 3}}}]),e}();const b=G;return r.default})()}));