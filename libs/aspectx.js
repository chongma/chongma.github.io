var e={d:(r,n)=>{for(var t in n)e.o(n,t)&&!e.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:n[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)},r={};function n(e){throw new TypeError('"'+e+'" is read-only')}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function a(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}e.d(r,{w2:()=>ke,$r:()=>ne,xd:()=>Xe,Kz:()=>ge});var o={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,BigInt64:8,BigUInt64:8,Float:4,Double:8};const i=function(){function e(r){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t(this,e),this.endianness=n?"LE":"BE",this.buffer=r,this.position=0}var r,n;return r=e,(n=[{key:"readNumericType",value:function(e){var r=o[e],n=this.buffer.slice(this.position,this.position+r)["read"+e+(r>1?this.endianness:"")](0);return this.position+=r,n}},{key:"readDouble",value:function(){return this.readNumericType("Double")}},{key:"readFloat",value:function(){return this.readNumericType("Float")}},{key:"readShort",value:function(){return this.readNumericType("Int16")}},{key:"readInt",value:function(){return this.readNumericType("Int32")}},{key:"javaBoolean",value:function(){return-1==this.readShort()}},{key:"sexType",value:function(){return-1==this.readShort()?"MALE":"FEMALE"}},{key:"close",value:function(){}}])&&a(r.prototype,n),e}(),_={UNLABELLED:1,WHOLE_BODY:2,LEFT_LEG:3,RIGHT_LEG:4,TORSO:5,LEFT_ARM:7,RIGHT_ARM:8,CHEST_WALL:9,LEFT_BREAST:10,RIGHT_BREAST:11,MJB_BUST:12,properties:{1:{name:"Unlabelled"},2:{name:"Whole body"},3:{name:"Left leg"},4:{name:"Right leg"},5:{name:"Torso"},7:{name:"Left arm"},8:{name:"Right arm"},9:{name:"Chest wall"},10:{name:"Left breast"},11:{name:"Right breast"},12:{name:"MJB bust"}},fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))[0]}};function l(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function E(e,r){var n,t=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return l(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}(e.bodyParts);try{for(t.s();!(n=t.n()).done;){var a=n.value;if(_[a.id]==r)return a}}catch(e){t.e(e)}finally{t.f()}return null}function s(e){return e.layers[0]}function R(e,r){return null==r?-1:T(e,r.y)}function T(e,r){for(var n=32766,t=-1,a=0;a<e.layers.length;a++){var o=e.layers[a],i=Math.abs(o.y-r);i<n&&(n=i,t=a)}return t}function L(e,r){var n=r.x-e.x,t=r.y-e.y;return Math.sqrt(n*n+t*t)}function u(e,r){return e>r?e:r}function f(e,r){return(e+r)/2}function c(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function y(e){e.parametricNodes=function(e){var r=0,n=[],t=[],a={x:0,y:e.nodes[0].point.x};n.push(a);var o={x:0,y:e.nodes[0].point.y};t.push(o);for(var i=1;i<e.nodes.length;i++){var _=e.nodes[i].point;a={x:r+=L(e.nodes[i-1].point,_),y:_.x},n.push(a),o={x:r,y:_.y},t.push(o)}var l={};return l.xsPoints=n,l.ysPoints=t,l}(e);var r={};r.xs_coeffs=d(e,e.parametricNodes.xsPoints),r.ys_coeffs=d(e,e.parametricNodes.ysPoints),e.parametricCoefficients=r}function d(e,r){var n=e.nodes.length;if(0==n)return null;for(var t=n-1,a=Array(n).fill(0),o=Array(t).fill(0),i=Array(n).fill().map((function(){return Array(n).fill(0)})),_=Array(t+1).fill(0),l=Array(n).fill(0),E=Array(n).fill(0),s=Array(n).fill(0),R=0;R<n;R++){var T=r[R];a[R]=T.x,l[R]=T.y}for(var L=0;L<t;L++)o[L]=a[L+1]-a[L];i[0][0]=1,i[0][1]=0,i[t][t]=1,i[t][t-1]=0;for(var u=1;u<t;u++)i[u][u]=2*(o[u-1]+o[u]),i[u][u-1]=o[u-1],i[u][u+1]=o[u];_[0]=0;for(var f=1;f<t;f++)_[f]=3/o[f]*(l[f+1]-l[f])-3/o[f-1]*(l[f]-l[f-1]);_[t]=0;for(var c=function(e,r,n){var t=Array(e).fill().map((function(){return Array(e).fill(0)})),a=Array(e).fill().map((function(){return Array(e).fill(0)})),o=Array(e).fill(0),i=Array(e).fill(0),_=e-1;if(e>=3){t[0][0]=r[0][0],a[0][1]=r[0][1]/t[0][0];for(var l=1;l<_;l++)t[l][l-1]=r[l][l-1],t[l][l]=r[l][l]-t[l][l-1]*a[l-1][l],a[l][l+1]=r[l][l+1]/t[l][l];t[_][_-1]=r[_][_-1],t[_][_]=r[_][_]-t[_][_-1]*a[_-1][_],o[0]=n[0]/t[0][0];for(var E=1;E<e;E++)o[E]=(n[E]-t[E][E-1]*o[E-1])/t[E][E];i[_]=o[_];for(var s=_-1;s>=0;s--)i[s]=o[s]-a[s][s+1]*i[s+1]}return i}(e.nodes.length,i,_),y=t-1;y>=0;y--)E[y]=(l[y+1]-l[y])/o[y]-o[y]*(c[y+1]+2*c[y])/3,s[y]=(c[y+1]-c[y])/(3*o[y]);for(var d=[],O=0;O<t;O++){var A={a:l[O],b:E[O],c:c[O],d:s[O]};d.push(A)}return d}function O(e,r,n,t){var a=t-n,o=e.b+2*e.c*a+3*e.d*a*a,i=r.b+2*r.c*a+3*r.d*a*a;return Math.sqrt(Math.pow(o,2)+Math.pow(i,2))}function A(e){return e.nodes[e.nodes.length-1]}function S(e,r,n,t,a){var o=[],i=0;if(n>=0&&t>0){var _=e.parametricNodes.xsPoints[n].x;i=(e.parametricNodes.xsPoints[t].x-_)/(r-1);var l=_,E=n,s=e.parametricNodes.xsPoints[E+1].x;if(0!=i)for(var R=0;R<r;R++){for(var T=_+R*i;T>s+1e-4;)E++,l=e.parametricNodes.xsPoints[E].x,s=e.parametricNodes.xsPoints[E+1].x;var L=e.parametricCoefficients.xs_coeffs[E],u=e.parametricCoefficients.ys_coeffs[E],f={point:{x:I(L,l,T),y:I(u,l,T)}};if(a){var c={},y=(T-e.parametricNodes.xsPoints[E].x)/(e.parametricNodes.xsPoints[E+1].x-e.parametricNodes.xsPoints[E].x);c.x=(1-y)*e.nodes[E].colour.x+y*e.nodes[E+1].colour.x,c.y=(1-y)*e.nodes[E].colour.y+y*e.nodes[E+1].colour.y,c.z=(1-y)*e.nodes[E].colour.z+y*e.nodes[E+1].colour.z,f.colour=c}o.push(f)}}return 0==i||n<0||t<0?null:o}function I(e,r,n){var t=n-r;return e.a+e.b*t+e.c*t*t+e.d*t*t*t}function m(e,r,n){if(null==e.nodes)e.nodes=[];else if(0==n);else if(!(Math.abs(r.x-A(e).point.x)+Math.abs(r.y-A(e).point.y)>=n))return!1;var t={point:{x:r.x,y:r.y}};return e.nodes.push(t),!0}function h(e,r){var n,t=[],a=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return c(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}(e.nodes);try{for(a.s();!(n=a.n()).done;){var o=n.value;t.push({x:o.point.x,y:r,z:o.point.y})}}catch(e){a.e(e)}finally{a.f()}return t}function p(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return H(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}function H(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function N(e){var r,n=M(),t=p(e.bodyParts);try{for(t.s();!(r=t.n()).done;){var a=r.value;v(a),G(n,a.extent)}}catch(e){t.e(e)}finally{t.f()}C(n),e.extent=n}function v(e){var r,n=M(),t=p(e.layers);try{for(t.s();!(r=t.n()).done;){var a=r.value;P(a),G(n,a.extent)}}catch(e){t.e(e)}finally{t.f()}if(null!=e.splineRegions){var o,i=p(e.splineRegions);try{for(i.s();!(o=i.n()).done;){var _=o.value;null!=_.vertices?_.extent=W(_.vertices):console.error(_," Vertices list is NULL")}}catch(e){i.e(e)}finally{i.f()}}C(n),e.extent=n}function P(e){var r=M();if(null!=e.pointLayer){var n,t=p(e.pointLayer.points);try{for(t.s();!(n=t.n()).done;)g(r,n.value)}catch(e){t.e(e)}finally{t.f()}}null!=e.splineLayer&&(null!=e.splineLayer.surface&&(x(e.splineLayer.surface),F(r,e.splineLayer.surface.extent,e.y)),null!=e.splineLayer.tape&&(x(e.splineLayer.tape),F(r,e.splineLayer.tape.extent,e.y))),C(r),e.extent=r}function x(e){if(e.nodes.length>2){e.extent={min:{x:32700,y:32700},mid:{x:0,y:0},max:{x:-32700,y:-32700}},e.samplePoints=S(e,200,0,e.nodes.length-1,!1);var r,n=p(e.samplePoints);try{for(n.s();!(r=n.n()).done;){var t=r.value.point;a=e.extent,o=t.x,i=t.y,o>a.max.x&&(a.max.x=o),o<a.min.x&&(a.min.x=o),i>a.max.y&&(a.max.y=i),i<a.min.y&&(a.min.y=i),function(e){e.mid={x:(e.min.x+e.max.x)/2,y:(e.min.y+e.max.y)/2}}(a)}}catch(e){n.e(e)}finally{n.f()}}var a,o,i}function G(e,r){r.max.x>e.max.x&&(e.max.x=r.max.x),r.min.x<e.min.x&&(e.min.x=r.min.x),r.max.y>e.max.y&&(e.max.y=r.max.y),r.min.y<e.min.y&&(e.min.y=r.min.y),r.max.z>e.max.z&&(e.max.z=r.max.z),r.min.z<e.min.z&&(e.min.z=r.min.z)}function g(e,r){r.x>e.max.x&&(e.max.x=r.x),r.x<e.min.x&&(e.min.x=r.x),r.y>e.max.y&&(e.max.y=r.y),r.y<e.min.y&&(e.min.y=r.y),r.z>e.max.z&&(e.max.z=r.z),r.z<e.min.z&&(e.min.z=r.z)}function F(e,r,n){e.min.x=r.min.x,e.min.y=n,e.min.z=r.min.y,e.max.x=r.max.x,e.max.y=n,e.max.z=r.max.y}function M(){return C(e={max:{x:-32700,y:-32700,z:-32700},min:{x:32700,y:32700,z:32700}}),e;var e}function C(e){e.mid=function(e){return{x:(e.min.x+e.max.x)/2,y:(e.min.y+e.max.y)/2,z:(e.min.z+e.max.z)/2}}(e),e.difference=function(e){return{x:e.max.x-e.min.x,y:e.max.y-e.min.y,z:e.max.z-e.min.z}}(e)}function W(e){var r=M();for(var n in e)g(r,n);return C(r),r}function b(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return z(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}function z(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function w(e,r){var n,t=b(e.layers);try{for(t.s();!(n=t.n()).done;)U(n.value,r)}catch(e){t.e(e)}finally{t.f()}}function U(e,r){null!=e.pointLayer&&function(e,r){var n,t=b(e.points);try{for(t.s();!(n=t.n()).done;){var a=n.value;a.x=a.x-r.x,a.z=a.z-r.z}}catch(e){t.e(e)}finally{t.f()}}(e.pointLayer,r),null!=e.splineLayer&&function(e,r){null!=e.surface&&K(e.surface,r),null!=e.tape&&K(e.tape,r)}(e.splineLayer,r),e.y=e.y+r.y}function K(e,r){var n,t=b(e.nodes);try{for(t.s();!(n=t.n()).done;){var a=n.value.point;a.x=a.x-r.x,a.y=a.y-r.z}}catch(e){t.e(e)}finally{t.f()}e.nodes.length>2&&y(e),x(e)}function D(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function B(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var t,a,o=[],i=!0,_=!1;try{for(n=n.call(e);!(i=(t=n.next()).done)&&(o.push(t.value),!r||o.length!==r);i=!0);}catch(e){_=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(_)throw a}}return o}}(e,r)||function(e,r){if(e){if("string"==typeof e)return D(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const X={TOP_HEAD:1,CHIN:2,NAPE:3,NAPE_INTERNAL:4,NAPE_LEVEL:5,NECK_INTERNAL:6,FRONT_NECK:7,LEFT_SIDE_NECK:8,RIGHT_SIDE_NECK:9,LEFT_SHOULDER:10,RIGHT_SHOULDER:11,LEFT_ARMPIT:12,RIGHT_ARMPIT:13,ARMPIT_INTERNAL:14,CHEST_INTERNAL:15,CHEST_LEVEL:16,LOW_CHEST_LEVEL:17,LOW_CHEST_INTERNAL:18,LEFT_NIPPLE:19,RIGHT_NIPPLE:20,REAR_WAIST:21,FRONT_WAIST:22,WAIST_INTERNAL:23,WAIST_LEVEL:24,TOP_HIP_LEVEL:25,SEAT_PROMINENCE:26,HIP_INTERNAL:27,HIP_LEVEL:28,CROTCH:29,FRONT_CHEST:31,FRONT_LOW_CHEST:32,MID_WAIST_INTERNAL:33,MID_WAIST_LEVEL:34,BACK_PROMINENCE:35,ABDOMEN_PROMINENCE:36,BACK_ARCH:37,LOWER_BUTTOCK:38,UPPER_ABDOMEN:39,LOWER_ABDOMEN:40,LEFT_SIDE_WAIST_BILATERAL:41,RIGHT_SIDE_WAIST_BILATERAL:42,SHOULDER_INTERNAL:43,LEFT_ARMPIT_INTERNAL:46,RIGHT_ARMPIT_INTERNAL:47,REAR_MID_WAIST:48,FRONT_MID_WAIST:49,LEFT_TOP_THIGH_INTERNAL:50,RIGHT_TOP_THIGH_INTERNAL:51,LEFT_TOP_THIGH_LEVEL:52,RIGHT_TOP_THIGH_LEVEL:53,LEFT_KNEE_INTERNAL:54,RIGHT_KNEE_INTERNAL:55,LEFT_KNEE_LEVEL:56,RIGHT_KNEE_LEVEL:57,LEFT_CALF:58,RIGHT_CALF:59,LEFT_CALF_LEVEL:60,RIGHT_CALF_LEVEL:61,LEFT_MINIMUM_LEG_INTERNAL:62,RIGHT_MINIMUM_LEG_INTERNAL:63,LEFT_MINIMUM_LEG_LEVEL:64,RIGHT_MINIMUM_LEG_LEVEL:65,LEFT_ANKLE_INTERNAL:66,RIGHT_ANKLE_INTERNAL:67,LEFT_ANKLE_LEVEL:68,RIGHT_ANKLE_LEVEL:69,LEFT_FLOOR:70,RIGHT_FLOOR:71,LEFT_FLOOR_LEVEL:72,RIGHT_FLOOR_LEVEL:73,LEFT_MID_THIGH_LEVEL:75,RIGHT_MID_THIGH_LEVEL:76,LEFT_TOP_ARM_INTERNAL:100,RIGHT_TOP_ARM_INTERNAL:101,LEFT_TOP_ARM_LEVEL:102,RIGHT_TOP_ARM_LEVEL:103,LEFT_ELBOW:104,RIGHT_ELBOW:105,LEFT_ARMCREASE:106,RIGHT_ARMCREASE:107,LEFT_ELBOW_INTERNAL:108,RIGHT_ELBOW_INTERNAL:109,LEFT_WRIST_INNER:110,RIGHT_WRIST_INNER:111,LEFT_WRIST_OUTER:112,RIGHT_WRIST_OUTER:113,LEFT_WRIST_INTERNAL:114,RIGHT_WRIST_INTERNAL:115,LEFT_WRIST_LEVEL:116,RIGHT_WRIST_LEVEL:117,LEFT_HAND:118,RIGHT_HAND:119,CWALL_L_HIGH_CHEST:1501,CWALL_L_ARMPIT:1502,CWALL_L_CHEST:1503,CWALL_L_LOW_CHEST:1504,CWALL_L_WAIST:1505,CWALL_MID_HIGH_CHEST:1506,CWALL_MID_ARMPIT:1507,CWALL_MID_CHEST:1508,CWALL_MID_LOW_CHEST:1509,CWALL_MID_WAIST:1510,CWALL_R_HIGH_CHEST:1511,CWALL_R_ARMPIT:1512,CWALL_R_CHEST:1513,CWALL_R_LOW_CHEST:1514,CWALL_R_WAIST:1515,properties:{1:{name:"Top of head",spline:!0},2:{name:"Chin"},3:{name:"Nape"},4:{name:"Nape internal"},5:{name:"Nape level"},6:{name:"Neck internal",important:!0,spline:!0},7:{name:"Front neck",deform:!0},8:{name:"Left side neck"},9:{name:"Right side neck"},10:{name:"Left shoulder",deform:!0},11:{name:"Right shoulder",deform:!0},12:{name:"Left armpit",important:!0,partition:!0},13:{name:"Right armpit",important:!0,partition:!0},14:{name:"Armpit internal"},15:{name:"Chest internal"},16:{name:"Chest level",deform:!0},17:{name:"Low chest level",important:!0,deform:!0},18:{name:"Low chest internal"},19:{name:"Left nipple"},20:{name:"Right nipple"},21:{name:"Rear waist"},22:{name:"Front waist"},23:{name:"Waist internal",spline:!0},24:{name:"Waist level",important:!0},25:{name:"Top hip level"},26:{name:"Seat prominence",deform:!0},27:{name:"Hip internal",deform:!0},28:{name:"Hip level",important:!0},29:{name:"Crotch",important:!0,partition:!0},31:{name:"Front chest"},32:{name:"Front low chest"},33:{name:"Mid waist internal"},34:{name:"Mid waist level"},35:{name:"Back prominence"},36:{name:"Abdomen prominence"},37:{name:"Back arch"},38:{name:"Lower buttock"},39:{name:"Upper abdomen"},40:{name:"Lower abdomen"},41:{name:"Left side waist bilateral"},42:{name:"Right side waist bilateral"},43:{name:"Shoulder internal"},46:{name:"Left armpit internal"},47:{name:"Right armpit internal"},48:{name:"Rear mid waist"},49:{name:"Front mid waist"},50:{name:"Left top thigh internal",spline:!0},51:{name:"Right top thigh internal",spline:!0},52:{name:"Left top thigh level"},53:{name:"Right top thigh level"},54:{name:"Left knee internal",spline:!0},55:{name:"Right knee internal",spline:!0},56:{name:"Left knee level",important:!0},57:{name:"Right knee level",important:!0},58:{name:"Left calf"},59:{name:"Right calf"},60:{name:"Left calf level"},61:{name:"Right calf level"},62:{name:"Left minimum leg internal"},63:{name:"Right minimum leg internal"},64:{name:"Left minimum leg level"},65:{name:"Right minimum leg level"},66:{name:"Left ankle internal",spline:!0},67:{name:"Right ankle internal",spline:!0},68:{name:"Left ankle level",important:!0},69:{name:"Right ankle level",important:!0},70:{name:"Left floor",spline:!0},71:{name:"Right floor",spline:!0},72:{name:"Left floor level"},73:{name:"Right floor level"},75:{name:"Left mid thigh level"},76:{name:"Right mid thigh level"},100:{name:"Left top arm internal",spline:!0},101:{name:"Right top arm internal",spline:!0},102:{name:"Left top arm level"},103:{name:"Right top arm level"},104:{name:"Left elbow",important:!0},105:{name:"Right elbow",important:!0},106:{name:"Left armcrease"},107:{name:"Right armcrease"},108:{name:"Left elbow internal",spline:!0},109:{name:"Right elbow internal",spline:!0},110:{name:"Left wrist inner",important:!0},111:{name:"Right wrist inner",important:!0},112:{name:"Left wrist outer"},113:{name:"Right wrist outer"},114:{name:"Left wrist internal",deform:!0,spline:!0},115:{name:"Right wrist internal",deform:!0,spline:!0},116:{name:"Left wrist level"},117:{name:"Right wrist level"},118:{name:"Left hand",spline:!0},119:{name:"Right hand",spline:!0},1501:{name:"Chestwall left high chest"},1502:{name:"Chestwall left armpit"},1503:{name:"Chestwall left chest"},1504:{name:"Chestwall left low chest"},1505:{name:"Chestwall left waist"},1506:{name:"Chestwall mid high chest"},1507:{name:"Chestwall mid armpit"},1508:{name:"Chestwall mid chest"},1509:{name:"Chestwall mid low chest"},1510:{name:"Chestwall mid waist"},1511:{name:"Chestwall right high chest"},1512:{name:"Chestwall right armpit"},1513:{name:"Chestwall right chest"},1514:{name:"Chestwall right low chest"},1515:{name:"Chestwall right waist"}},fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))[0]}};function k(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function j(e,r){var n,t=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return k(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}(e.landmarks);try{for(t.s();!(n=t.n()).done;){var a=n.value;if(X[a.id]==r)return a}}catch(e){t.e(e)}finally{t.f()}return null}function V(e,r){return!!e.landmarks.find((function(e){return e.id===r}))}const $={TORSO_TOPHEAD:1,TORSO_FRONT_NECK:2,TORSO_NAPE:3,TORSO_NECK:4,TORSO_NECK_PREPROCESS:5,TORSO_NECK_UPPER:6,TORSO_NECK_LOWER:7,TORSO_SHOULDER_PREPROCESS:8,TORSO_SHOULDER:9,TORSO_ARMPIT_LOWER:10,TORSO_ARMPIT_UPPER:11,TORSO_ARMPIT_PREPROCESS:12,TORSO_ARMPIT:13,TORSO_LOW_CHEST_PREPROCESS:14,TORSO_LOW_CHEST:15,TORSO_CHEST_PREPROCESS:16,TORSO_CHEST:17,TORSO_WAIST_PREPROCESS:18,TORSO_WAIST:19,TORSO_WAIST_LOWER:20,TORSO_WAIST_UPPER:21,TORSO_SEAT_PROMINENCE:22,TORSO_HIP_PREPROCESS:23,TORSO_HIP:24,TORSO_HIP_LOWER:25,TORSO_HIP_UPPER:26,TORSO_CROTCH:27,TORSO_CROTCH_ARMPIT_THIRD:28,CHESTWALL_ARMPIT_PREPROCESS:29,CHESTWALL_CHEST_PREPROCESS:30,CHESTWALL_LOW_CHEST_PREPROCESS:31,CHESTWALL_WAIST_PREPROCESS:32,CHESTWALL_HIGH_CHEST_PREPROCESS:33,CHESTWALL_ARMPIT:34,CHESTWALL_CHEST:35,CHESTWALL_LOW_CHEST:36,CHESTWALL_WAIST:37,CHESTWALL_HIGH_CHEST:38,LEFTLEG_FLOOR:39,LEFTLEG_MINIMUM_LEG:40,LEFTLEG_ANKLE:41,LEFTLEG_ANKLE_LOWER:42,LEFTLEG_ANKLE_UPPER:43,LEFTLEG_KNEE:44,LEFTLEG_KNEE_LOWER:45,LEFTLEG_KNEE_UPPER:46,LEFTLEG_THIGH:47,RIGHTLEG_FLOOR:48,RIGHTLEG_MINIMUM_LEG:49,RIGHTLEG_ANKLE:50,RIGHTLEG_ANKLE_LOWER:51,RIGHTLEG_ANKLE_UPPER:52,RIGHTLEG_KNEE:53,RIGHTLEG_KNEE_LOWER:54,RIGHTLEG_KNEE_UPPER:55,RIGHTLEG_THIGH:56,LEFTARM_TOPARM:57,LEFTARM_ELBOW:58,LEFTARM_ELBOW_UPPER:59,LEFTARM_ELBOW_LOWER:60,LEFTARM_WRIST:61,LEFTARM_HAND:62,RIGHTARM_TOPARM:63,RIGHTARM_ELBOW:64,RIGHTARM_ELBOW_UPPER:65,RIGHTARM_ELBOW_LOWER:66,RIGHTARM_WRIST:67,RIGHTARM_HAND:68,fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))[0]}};function Y(e,r){if(e.layerMarkers)return e.layerMarkers.find((function(e){return $[e.layerNameType]==r}))}function J(e,r,n){var t=Y(e,r);t?t.value=n:(t={layerNameType:$.fromInt(r),value:n},e.layerMarkers||(e.layerMarkers=[]),e.layerMarkers.push(t))}function q(e,r,n,t){J(e,r,Z(e,n,t))}function Z(e,r,n){var t=Y(e,r),a=Y(e,n);return function(e,r,n){for(var t=r;t<n;t++){var a=e.layers[t],o=e.layers[t+1];if(a.y==o.y)return t}return 0}(e,t.value,a.value)}function Q(e,r,n){J(e,r,function(e,r){var n=Y(e,r);if(n)return n.value}(e,n)+1)}function ee(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return re(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}function re(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function ne(e,r,n){e.version=3.02;var t=function(e){var r=[];return Object.entries(X.properties).forEach((function(n){var t=B(n,2),a=t[0],o=t[1];o.partition&&!V(e,Number(a))&&r.push(o.name)})),r}(e);if(t.length)throw new Error("fit Splines: missing partition landmarks -> "+t.join(", "));var a=function(e){var r=[];return Object.entries(X.properties).forEach((function(n){var t=B(n,2),a=t[0],o=t[1];o.spline&&!V(e,Number(a))&&r.push(o.name)})),r}(e);if(a.length)throw new Error("fit Splines: missing spline landmarks -> "+a.join(", "));oe(e,!r);var o,i=1*e.xZResolutionMM*10*3,_=ee(e.bodyParts);try{for(_.s();!(o=_.n()).done;)te(o.value,i,e.normaliseResolution,e.colour)}catch(e){_.e(e)}finally{_.f()}e.rawPointsDefined=!1,e.normalisedPointsInLayer=!0}function te(e,r,n,t){var a,o=ee(e.splineRegions);try{for(o.s();!(a=o.n()).done;){var i=a.value;try{console.log(e.id+", "+i.id),e.id==_.TORSO?5!=i.id&&4!=i.id&&3!=i.id&&8!=i.id&&14!=i.id||ae(i,e.layers,0,r,!1,t):e.id==_.CHEST_WALL?3==i.id&&ae(i,e.layers,0,r,!0,!1):e.id==_.LEFT_LEG||e.id==_.RIGHT_LEG?6!=i.id&&7!=i.id&&13!=i.id||ae(i,e.layers,0,r,!1,t):e.id!=_.LEFT_ARM&&e.id!=_.RIGHT_ARM||15!=i.id&&18!=i.id||ae(i,e.layers,0,r,!1,t)}catch(e){console.error(e)}}}catch(e){o.e(e)}finally{o.f()}}function ae(e,r,n,t,a,o){for(var i=e.startLayer;i<=e.endLayer;i++){var _=r[i],l=getLayerCentroid(e,i);_.odd=i%2!=0;var E=convertPointLayerToSplineLayer(_,t,l,e.noRadial,e.noLinear,OpenClosedType.CLOSED,a,o);E&&(_.splineLayer=E,createStandardisedSpline(_,l,e.noRadial,e.noLinear,o))}e.id}function oe(e,r,n){var t,a=ee(e.bodyParts);try{for(a.s();!(t=a.n()).done;)ie(e,t.value,r)}catch(e){a.e(e)}finally{a.f()}}function ie(e,r,n){n?function(e,r){if(r.id==_.TORSO){var n=j(e,X.CHEST_LEVEL),t=j(e,X.LOW_CHEST_LEVEL),a=j(e,X.WAIST_INTERNAL),o=j(e,X.HIP_INTERNAL),i=j(e,X.NECK_INTERNAL);if(j(e,X.LEFT_SHOULDER),j(e,X.RIGHT_SHOULDER),e.version>1.99){J(r,$.TORSO_TOPHEAD,r.layers.length-1),J(r,$.TORSO_NECK_PREPROCESS,getNearestLayerLocal(r,i.y,0)),J(r,$.TORSO_WAIST_PREPROCESS,getNearestLayerLocal(r,a.y,0)),J(r,$.TORSO_HIP_PREPROCESS,getNearestLayerLocal(r,o.y,0)),J(r,$.TORSO_CROTCH,0),q(r,$.TORSO_ARMPIT_LOWER,$.TORSO_CROTCH,$.TORSO_TOPHEAD),updateLayerMarkerSame(r,$.TORSO_ARMPIT_PREPROCESS,$.TORSO_ARMPIT_LOWER),Q(r,$.TORSO_ARMPIT_UPPER,$.TORSO_ARMPIT_LOWER),J(r,$.TORSO_CHEST_PREPROCESS,T(r,n.y)),J(r,$.TORSO_LOW_CHEST_PREPROCESS,T(r,t.y));var l=layerMarker(r,$.TORSO_ARMPIT_LOWER);J(r,$.TORSO_CROTCH_ARMPIT_THIRD,Math.round(.333*l.value))}else e.version>1.199&&(J(r,$.TORSO_NECK_PREPROCESS,r.layers.length-1),J(r,$.TORSO_WAIST_PREPROCESS,getNearestLayerLocal(r,a.y,0)),J(r,$.TORSO_HIP_PREPROCESS,getNearestLayerLocal(r,o.y,0)),J(r,$.TORSO_CROTCH,0),q(r,$.TORSO_ARMPIT_LOWER,$.TORSO_WAIST,$.TORSO_NECK),updateLayerMarkerSame(r,$.TORSO_ARMPIT_PREPROCESS,$.TORSO_ARMPIT_LOWER),Q(r,$.TORSO_ARMPIT_UPPER,$.TORSO_ARMPIT_LOWER));updateLayerMarkerSame(r,$.TORSO_WAIST_LOWER,$.TORSO_WAIST_PREPROCESS),updateLayerMarkerSame(r,$.TORSO_WAIST_UPPER,$.TORSO_WAIST_PREPROCESS),updateLayerMarkerSame(r,$.TORSO_HIP_LOWER,$.TORSO_HIP_PREPROCESS),updateLayerMarkerSame(r,$.TORSO_HIP_UPPER,$.TORSO_HIP_PREPROCESS),updateLayerMarkerSame(r,$.TORSO_NECK_LOWER,$.TORSO_NECK_PREPROCESS),updateLayerMarkerSame(r,$.TORSO_NECK_UPPER,$.TORSO_NECK_PREPROCESS),updateLayerMarkerSame(r,$.TORSO_LOW_CHEST,$.TORSO_LOW_CHEST_PREPROCESS)}var s=E(e,_.CHEST_WALL);if(null!=s){var R=layerMarker(r,$.TORSO_LOW_CHEST_PREPROCESS),L=layerMarker(r,$.TORSO_WAIST_PREPROCESS),f=layerMarker(r,$.TORSO_ARMPIT_PREPROCESS),c=layerMarker(r,$.TORSO_NECK_PREPROCESS);J(s,$.CHESTWALL_WAIST_PREPROCESS,0);var y=R.value-L.value;J(s,$.CHESTWALL_LOW_CHEST_PREPROCESS,y);var d=f.value-L.value;J(s,$.CHESTWALL_ARMPIT_PREPROCESS,d),J(s,$.CHESTWALL_HIGH_CHEST_PREPROCESS,(c.value+f.value+1)/2-L.value),J(s,$.CHESTWALL_CHEST_PREPROCESS,(5*d+5*y)/10),updateLayerMarkerSame(s,$.CHESTWALL_WAIST,$.CHESTWALL_WAIST_PREPROCESS),updateLayerMarkerSame(s,$.CHESTWALL_CHEST,$.CHESTWALL_CHEST_PREPROCESS),updateLayerMarkerSame(s,$.CHESTWALL_ARMPIT,$.CHESTWALL_ARMPIT_PREPROCESS)}if(r.id==_.LEFT_LEG){var O=j(e,X.LEFT_KNEE_INTERNAL),A=j(e,X.LEFT_ANKLE_INTERNAL);J(r,$.LEFTLEG_THIGH,r.layers.length-1),J(r,$.LEFTLEG_KNEE,getNearestNonEmptyLayerLocal(r,O.y,0)),J(r,$.LEFTLEG_ANKLE,u(2,getNearestNonEmptyLayerLocal(r,A.y,0))),J(r,$.LEFTLEG_FLOOR,0),updateLayerMarkerSame(r,$.LEFTLEG_ANKLE_LOWER,$.LEFTLEG_ANKLE),updateLayerMarkerSame(r,$.LEFTLEG_ANKLE_UPPER,$.LEFTLEG_ANKLE),updateLayerMarkerSame(r,$.LEFTLEG_KNEE_LOWER,$.LEFTLEG_KNEE),updateLayerMarkerSame(r,$.LEFTLEG_KNEE_UPPER,$.LEFTLEG_KNEE)}if(r.id==_.RIGHT_LEG){var S=j(e,X.RIGHT_KNEE_INTERNAL),I=j(e,X.RIGHT_ANKLE_INTERNAL);J(r,$.RIGHTLEG_THIGH,r.layers.length-1),J(r,$.RIGHTLEG_KNEE,getNearestNonEmptyLayerLocal(r,S.y,0)),J(r,$.RIGHTLEG_ANKLE,u(2,getNearestNonEmptyLayerLocal(r,I.y,0))),J(r,$.RIGHTLEG_FLOOR,0),updateLayerMarkerSame(r,$.RIGHTLEG_ANKLE_LOWER,$.RIGHTLEG_ANKLE),updateLayerMarkerSame(r,$.RIGHTLEG_ANKLE_UPPER,$.RIGHTLEG_ANKLE),updateLayerMarkerSame(r,$.RIGHTLEG_KNEE_LOWER,$.RIGHTLEG_KNEE),updateLayerMarkerSame(r,$.RIGHTLEG_KNEE_UPPER,$.RIGHTLEG_KNEE)}if(r.id==_.LEFT_ARM){var m=j(e,X.LEFT_ELBOW_INTERNAL),h=j(e,X.LEFT_WRIST_INTERNAL);J(r,$.LEFTARM_TOPARM,r.layers.length-1),J(r,$.LEFTARM_ELBOW,getNearestNonEmptyLayerLocal(r,m.y,0)),J(r,$.LEFTARM_WRIST,getNearestNonEmptyLayerLocal(r,h.y,0)),J(r,$.LEFTARM_HAND,0),updateLayerMarkerSame(r,$.LEFTARM_ELBOW_LOWER,$.LEFTARM_ELBOW),updateLayerMarkerSame(r,$.LEFTARM_ELBOW_UPPER,$.LEFTARM_ELBOW)}if(r.id==_.RIGHT_ARM){var p=j(e,X.RIGHT_ELBOW_INTERNAL),H=j(e,X.RIGHT_WRIST_INTERNAL);J(r,$.RIGHTARM_TOPARM,r.layers.length-1),J(r,$.RIGHTARM_ELBOW,getNearestNonEmptyLayerLocal(r,p.y,0)),J(r,$.RIGHTARM_WRIST,getNearestNonEmptyLayerLocal(r,H.y,0)),J(r,$.RIGHTARM_HAND,0),updateLayerMarkerSame(r,$.RIGHTARM_ELBOW_LOWER,$.RIGHTARM_ELBOW),updateLayerMarkerSame(r,$.RIGHTARM_ELBOW_UPPER,$.RIGHTARM_ELBOW)}}(e,r):function(e,r){if(_[r.id]==_.LEFT_LEG&&(J(r,$.LEFTLEG_THIGH,r.layers.length-1),J(r,$.LEFTLEG_FLOOR,0),q(r,$.LEFTLEG_ANKLE_LOWER,$.LEFTLEG_FLOOR,$.LEFTLEG_THIGH),Q(r,$.LEFTLEG_ANKLE_UPPER,$.LEFTLEG_ANKLE_LOWER),J(r,$.LEFTLEG_KNEE_LOWER,Z(r,$.LEFTLEG_ANKLE_UPPER,$.LEFTLEG_THIGH)),Q(r,$.LEFTLEG_KNEE_UPPER,$.LEFTLEG_KNEE_LOWER)),_[r.id]==_.RIGHT_LEG&&(J(r,$.RIGHTLEG_THIGH,r.layers.length-1),J(r,$.RIGHTLEG_FLOOR,0),q(r,$.RIGHTLEG_ANKLE_LOWER,$.RIGHTLEG_FLOOR,$.RIGHTLEG_THIGH),Q(r,$.RIGHTLEG_ANKLE_UPPER,$.RIGHTLEG_ANKLE_LOWER),q(r,$.RIGHTLEG_KNEE_LOWER,$.RIGHTLEG_ANKLE_UPPER,$.RIGHTLEG_THIGH),Q(r,$.RIGHTLEG_KNEE_UPPER,$.RIGHTLEG_KNEE_LOWER)),_[r.id]==_.LEFT_ARM&&(J(r,$.LEFTARM_TOPARM,r.layers.length-1),J(r,$.LEFTARM_HAND,0),q(r,$.LEFTARM_ELBOW_LOWER,$.LEFTARM_HAND,$.LEFTARM_TOPARM),Q(r,$.LEFTARM_ELBOW_UPPER,$.LEFTARM_ELBOW_LOWER),J(r,$.LEFTARM_WRIST,0)),_[r.id]==_.RIGHT_ARM&&(J(r,$.RIGHTARM_TOPARM,r.layers.length-1),J(r,$.RIGHTARM_HAND,0),q(r,$.RIGHTARM_ELBOW_LOWER,$.RIGHTARM_HAND,$.RIGHTARM_TOPARM),Q(r,$.RIGHTARM_ELBOW_UPPER,$.RIGHTARM_ELBOW_LOWER),J(r,$.RIGHTARM_WRIST,0)),_[r.id]==_.TORSO||_[r.id]==_.CHEST_WALL){var n=j(e,X.CHEST_LEVEL),t=j(e,X.LOW_CHEST_LEVEL),a=j(e,X.LEFT_SHOULDER),o=j(e,X.RIGHT_SHOULDER);J(r,$.TORSO_TOPHEAD,r.layers.length-1),J(r,$.TORSO_CROTCH,0),q(r,$.TORSO_HIP_LOWER,$.TORSO_CROTCH,$.TORSO_TOPHEAD),Q(r,$.TORSO_HIP_UPPER,$.TORSO_HIP_LOWER),q(r,$.TORSO_WAIST_LOWER,$.TORSO_HIP_UPPER,$.TORSO_TOPHEAD),Q(r,$.TORSO_WAIST_UPPER,$.TORSO_WAIST_LOWER),q(r,$.TORSO_ARMPIT_LOWER,$.TORSO_WAIST_UPPER,$.TORSO_TOPHEAD),Q(r,$.TORSO_ARMPIT_UPPER,$.TORSO_ARMPIT_LOWER),q(r,$.TORSO_NECK_LOWER,$.TORSO_ARMPIT_UPPER,$.TORSO_TOPHEAD),Q(r,$.TORSO_NECK_UPPER,$.TORSO_NECK_LOWER);var i=Y(r,$.TORSO_ARMPIT_LOWER);if(1==e.sex){var l=Y(r,$.TORSO_WAIST_UPPER),s=l.value+.8*(i.value-l.value),L=l.value+.8*(s-l.value);J(r,$.TORSO_CHEST,s),J(r,$.TORSO_LOW_CHEST,L)}else J(r,$.TORSO_CHEST,R(r,n)),J(r,$.TORSO_LOW_CHEST,R(r,t));null!=a&&null!=o&&J(r,$.TORSO_SHOULDER,T(r,f(a.y,o.y)));var u=Math.floor(.333*i.value);J(r,$.TORSO_CROTCH_ARMPIT_THIRD,u)}if(_[r.id]==_.CHEST_WALL){var c=E(e,_.TORSO),y=Y(c,$.TORSO_LOW_CHEST),d=Y(c,$.TORSO_WAIST_UPPER),O=Y(c,$.TORSO_ARMPIT_LOWER),A=Y(c,$.TORSO_NECK_LOWER),S=Y(c,$.TORSO_ARMPIT_UPPER);J(r,$.CHESTWALL_WAIST,0),J(r,$.CHESTWALL_LOW_CHEST,y.value-d.value),J(r,$.CHESTWALL_ARMPIT,O.value-d.value),J(r,$.CHESTWALL_HIGH_CHEST,(A.value+S.value)/2-d.value);var I=Y(r,$.CHESTWALL_ARMPIT),m=Y(r,$.CHESTWALL_LOW_CHEST);J(r,$.CHESTWALL_CHEST,(5*I.value+5*m.value)/10)}}(e,r);var t=[];if(_[r.id]==_.TORSO){var a=Y(r,$.TORSO_NECK_UPPER),o=Y(r,$.TORSO_TOPHEAD),i=Y(r,$.TORSO_ARMPIT_UPPER),l=Y(r,$.TORSO_NECK_LOWER),s=Y(r,$.TORSO_WAIST_UPPER),L=Y(r,$.TORSO_ARMPIT_LOWER),c=Y(r,$.TORSO_HIP_UPPER),y=Y(r,$.TORSO_WAIST_LOWER),d=Y(r,$.TORSO_CROTCH),O=Y(r,$.TORSO_CROTCH_ARMPIT_THIRD);t.push(_e(e,r,14,a,o)),t.push(_e(e,r,8,i,l)),t.push(_e(e,r,3,s,L)),t.push(_e(e,r,4,c,y)),t.push(_e(e,r,5,d,c)),t.push(_e(e,r,36,O,i))}if(_[r.id]==_.CHEST_WALL)if(n){var A=Y(r,$.CHESTWALL_WAIST_PREPROCESS),S=Y(r,$.CHESTWALL_ARMPIT_PREPROCESS);t.push(_e(e,r,3,A,S))}else{var I=Y(r,$.CHESTWALL_WAIST),m=Y(r,$.CHESTWALL_ARMPIT);t.push(_e(e,r,3,I,m))}if(_[r.id]==_.LEFT_LEG){var h=Y(r,$.LEFTLEG_KNEE_UPPER),p=Y(r,$.LEFTLEG_THIGH),H=Y(r,$.LEFTLEG_ANKLE_UPPER),N=Y(r,$.LEFTLEG_KNEE_LOWER),v=Y(r,$.LEFTLEG_FLOOR),P=Y(r,$.LEFTLEG_ANKLE_LOWER);t.push(_e(e,r,6,h,p)),t.push(_e(e,r,7,H,N)),t.push(_e(e,r,13,v,P))}if(_[r.id]==_.RIGHT_LEG){var x=Y(r,$.RIGHTLEG_KNEE_UPPER),G=Y(r,$.RIGHTLEG_THIGH),g=Y(r,$.RIGHTLEG_ANKLE_UPPER),F=Y(r,$.RIGHTLEG_KNEE_LOWER),M=Y(r,$.RIGHTLEG_FLOOR),C=Y(r,$.RIGHTLEG_ANKLE_LOWER);t.push(_e(e,r,6,x,G)),t.push(_e(e,r,7,g,F)),t.push(_e(e,r,13,M,C))}if(_[r.id]==_.LEFT_ARM){var W=Y(r,$.LEFTARM_ELBOW_UPPER),b=Y(r,$.LEFTARM_TOPARM),z=Y(r,$.LEFTARM_WRIST),w=Y(r,$.LEFTARM_ELBOW_LOWER);t.push(_e(e,r,15,W,b)),t.push(_e(e,r,18,z,w))}if(_[r.id]==_.RIGHT_ARM){var U=Y(r,$.RIGHTARM_ELBOW_UPPER),K=Y(r,$.RIGHTARM_TOPARM),D=Y(r,$.RIGHTARM_WRIST),B=Y(r,$.RIGHTARM_ELBOW_LOWER);t.push(_e(e,r,15,U,K)),t.push(_e(e,r,18,D,B))}t=t.filter((function(e){return e})),r.splineRegions=t}function _e(e,r,n,t,a){var o=t.value,i=a.value;if(o>=0&&i>=o){var l={id:n,startLayer:o,endLayer:i,startVertex:0},E=null;if(5==n){var s=Y(r,$.TORSO_HIP_LOWER);E=r.layers[s.value]}else if(36==n){var R=Y(r,$.TORSO_CROTCH_ARMPIT_THIRD);E=r.layers[R.value]}else if(8==n){var T=Y(r,$.TORSO_NECK_LOWER);E=r.layers[T.value]}return function(e,r){switch(e.id){case 6:case 7:1==r?(e.noRadial=5,e.noLinear=0,e.noNormalisedLayers=16):2==r?(e.noRadial=7,e.noLinear=0,e.noNormalisedLayers=24):(e.noRadial=9,e.noLinear=0,e.noNormalisedLayers=32);break;case 13:1==r?(e.noRadial=5,e.noLinear=0,e.noNormalisedLayers=4):2==r?(e.noRadial=7,e.noLinear=0,e.noNormalisedLayers=6):(e.noRadial=9,e.noLinear=0,e.noNormalisedLayers=8);break;case 5:1==r?(e.noRadial=4,e.noLinear=8,e.noNormalisedLayers=5):2==r?(e.noRadial=6,e.noLinear=12,e.noNormalisedLayers=8):(e.noRadial=8,e.noLinear=16,e.noNormalisedLayers=10);break;case 4:case 3:1==r?(e.noRadial=8,e.noLinear=0,e.noNormalisedLayers=15):2==r?(e.noRadial=12,e.noLinear=0,e.noNormalisedLayers=24):(e.noRadial=16,e.noLinear=0,e.noNormalisedLayers=30);break;case 8:1==r?(e.noRadial=4,e.noLinear=6,e.noNormalisedLayers=16):2==r?(e.noRadial=6,e.noLinear=20,e.noNormalisedLayers=24):(e.noRadial=8,e.noLinear=12,e.noNormalisedLayers=32);break;case 14:1==r?(e.noRadial=7,e.noLinear=0,e.noNormalisedLayers=10):2==r?(e.noRadial=16,e.noLinear=0,e.noNormalisedLayers=15):(e.noRadial=14,e.noLinear=0,e.noNormalisedLayers=20);break;case 15:1==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=8):2==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=12):(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=16);break;case 18:1==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=12):2==r?(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=18):(e.noRadial=4,e.noLinear=0,e.noNormalisedLayers=24);break;default:console.log("Using default Spline Region settings for "+e.id),e.noRadial=5,e.noLinear=5,e.noNormalisedLayers=24}}(l,e.normaliseResolution),function(e,r,n,t,a){var o,i,l,E,s,R,T,L,u,c,y,d,O,A,S,I,m,h,p,H,N,v,P,x={left:{x:0,y:0},right:{x:0,y:0}},G={left:{x:0,y:0},right:{x:0,y:0}};switch(t){case 6:n==_.LEFT_LEG?(i=j(e,X.LEFT_TOP_THIGH_INTERNAL),o=j(e,X.LEFT_KNEE_INTERNAL)):(i=j(e,X.RIGHT_TOP_THIGH_INTERNAL),o=j(e,X.RIGHT_KNEE_INTERNAL)),x.left.x=o.x,x.left.y=o.z,x.right.x=o.x,x.right.y=o.z,G.left.x=i.x,G.left.y=i.z,G.right.x=i.x,G.right.y=i.z;break;case 7:n==_.LEFT_LEG?(E=j(e,X.LEFT_ANKLE_INTERNAL),o=j(e,X.LEFT_KNEE_INTERNAL)):(E=j(e,X.RIGHT_ANKLE_INTERNAL),o=j(e,X.RIGHT_KNEE_INTERNAL)),x.left.x=E.x,x.left.y=E.z,x.right.x=E.x,x.right.y=E.z,G.left.x=o.x,G.left.y=o.z,G.right.x=o.x,G.right.y=o.z;break;case 13:n==_.LEFT_LEG?(E=j(e,X.LEFT_ANKLE_INTERNAL),l=j(e,X.LEFT_FLOOR)):(E=j(e,X.RIGHT_ANKLE_INTERNAL),l=j(e,X.RIGHT_FLOOR)),x.left.x=l.x,x.left.y=l.z,x.right.x=l.x,x.right.y=l.z,G.left.x=E.x,G.left.y=E.z,G.right.x=E.x,G.right.y=E.z;break;case 5:T=j(e,X.HIP_INTERNAL),s=j(e,X.LEFT_TOP_THIGH_INTERNAL),R=j(e,X.RIGHT_TOP_THIGH_INTERNAL);var g=a;x.left.x=s.x,x.left.y=s.z,x.right.x=R.x,x.right.y=R.z,G.left.x=.75*g.extent.min.x+.25*g.extent.max.x,G.left.y=T.z,G.right.x=.25*g.extent.min.x+.75*g.extent.max.x,G.right.y=T.z;break;case 4:T=j(e,X.HIP_INTERNAL),u=j(e,X.WAIST_INTERNAL),x.left.x=T.x,x.left.y=T.z,x.right.x=T.x,x.right.y=T.z,G.left.x=u.x,G.left.y=u.z,G.right.x=u.x,G.right.y=u.z;break;case 3:c=j(e,X.LEFT_ARMPIT),y=j(e,X.RIGHT_ARMPIT),L={x:(c.x+y.x)/2,z:(c.z+y.z)/2},u=j(e,X.WAIST_INTERNAL),x.left.x=u.x,x.left.y=u.z,x.right.x=u.x,x.right.y=u.z,G.left.x=L.x,G.left.y=L.z,G.right.x=L.x,G.right.y=L.z;break;case 36:c=j(e,X.LEFT_ARMPIT),y=j(e,X.RIGHT_ARMPIT),L={x:(c.x+y.x)/2,z:(c.z+y.z)/2};var F=a;x.left.x=F.extent.mid.x,x.left.y=F.extent.mid.z,x.right.x=x.left.x,x.right.y=x.left.y,G.left.x=L.x,G.left.y=L.z,G.right.x=G.left.x,G.right.y=G.left.y;break;case 8:d={x:0,y:0},O={x:0,y:0},c=j(e,X.LEFT_ARMPIT_INTERNAL),y=j(e,X.RIGHT_ARMPIT_INTERNAL),S=j(e,X.NECK_INTERNAL);var M=a;M.extent.max.x-M.extent.min.x<12/(.6-.4)?(P=(M.extent.max.x+M.extent.min.x)/2,d.x=P-6,O.x=P+6):(d.x=.6*M.extent.min.x+.4*M.extent.max.x,O.x=.4*M.extent.min.x+.6*M.extent.max.x),I=j(e,X.LEFT_TOP_ARM_INTERNAL);var C=null!=c?c.x:0,W=null!=c?c.z:0,b=null!=y?y.x:0,z=null!=y?y.z:0;null!=I?(p=f(I.x,C),N=Math.ceil(.65*I.z+.35*W)):(p=C,N=W),null!=(I=j(e,X.RIGHT_TOP_ARM_INTERNAL))?(H=f(I.x,b),v=Math.ceil(.65*I.z+.35*z)):(H=b,v=z),x.left.x=p,x.left.y=N,x.right.x=H,x.right.y=v,G.left.x=d.x,G.left.y=S.z,G.right.x=O.x,G.right.y=S.z;break;case 14:A=j(e,X.TOP_HEAD),S=j(e,X.NECK_INTERNAL),x.left.x=S.x,x.left.y=S.z,x.right.x=S.x,x.right.y=S.z,G.left.x=A.x,G.left.y=A.z,G.right.x=A.x,G.right.y=A.z;break;case 15:n==_.LEFT_ARM?(I=j(e,X.LEFT_TOP_ARM_INTERNAL),h=j(e,X.LEFT_ELBOW_INTERNAL)):(I=j(e,X.RIGHT_TOP_ARM_INTERNAL),h=j(e,X.RIGHT_ELBOW_INTERNAL)),x.left.x=h.x,x.left.y=h.z,x.right.x=h.x,x.right.y=h.z,G.left.x=I.x,G.left.y=I.z,G.right.x=I.x,G.right.y=I.z;break;case 18:n==_.LEFT_ARM?(m=j(e,X.LEFT_WRIST_INTERNAL),h=j(e,X.LEFT_ELBOW_INTERNAL)):(m=j(e,X.RIGHT_WRIST_INTERNAL),h=j(e,X.RIGHT_ELBOW_INTERNAL)),x.left.x=m.x,x.left.y=m.z,x.right.x=m.x,x.right.y=m.z,G.left.x=h.x,G.left.y=h.z,G.right.x=h.x,G.right.y=h.z}r.start=x,r.end=G}(e,l,r.id,n,E),l}console.error("create spline region: body part ".concat(r.id," ").concat(n," start layer ").concat(o," and end layer ").concat(i," bad"))}function le(e,r){return e.splineRegions.find((function(e){return e.id==r}))}function Ee(e,r,n){return r.startVertex+(n-r.startLayer)*e.layers[n].splineLayer.surface.nodes.length}function se(e,r,n){if(e)return function(e,r){switch(r){case START_LEFT_X:return e.start.left.x;case START_LEFT_Y:return e.start.left.y;case START_RIGHT_X:return e.start.right.x;case START_RIGHT_Y:return e.start.right.y;case END_LEFT_X:return e.end.left.x;case END_LEFT_Y:return e.end.left.y;case END_RIGHT_X:return e.end.right.x;case END_RIGHT_Y:return e.end.right.y;case START_LAYER:return e.startLayer;case END_LAYER:return e.endLayer;case NRADIAL:return e.noRadial;case NLINEAR:return e.noLinear}return 0}(le(e,r),n)}function Re(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function Te(e,r,t,a,o,i,_){for(var l,E={},R={id:r,spline:{},outlineRefs:[]},T=e.layers.length-1;T>0&&(1!=o||T!=a);T--){var L=e.layers[T];E.x=2==i?2==_?L.extent.max.x:L.extent.max.z:2==_?L.extent.min.x:L.extent.min.z,E.y=L.y,m(R.spline,E,t)&&Le(R,{x:E.x,y:E.y,z:L.extent.mid.z})}l=1==o?e.layers[a]:s(e),E.x=2==i?2==_?l.extent.max.x:l.extent.max.z:2==_?l.extent.min.x:l.extent.min.z,E.y=l.y;var u=m(R.spline,E,t);return u||(remove_end_node(R.spline),m(R.spline,E,t),n("ok")),u&&Le(R,{x:E.x,y:E.y,z:l.extent.mid.z}),y(R.spline),R.spline.samplePoints=S(R.spline,200,0,R.spline.nodes.length-1,!1),R}function Le(e,r){e.outlineRefs.push(r)}function ue(e){var r=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)+Math.pow(e.z,2));0!=r&&(e.x=e.x/r,e.y=e.y/r,e.z=e.z/r)}function fe(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return ce(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}function ce(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function ye(e){if(!e.DONE_SMOOTH_NORMALS&&e.polygons&&e.polygons.length){e.DONE_NORMALS||function(e){if(!e.DONE_NORMALS){var r,n=e.vertices.length,t=fe(e.polygons);try{for(t.s();!(r=t.n()).done;)Oe(e,r.value,n)}catch(e){t.e(e)}finally{t.f()}e.DONE_NORMALS=!0}}(e),console.log("Spline region: "+e.id+", Vertices: "+e.vertices.length+", Polygons: "+e.polygons.length);for(var r,n,t=[],a=0;a<e.vertices.length;a++){var o,i={x:0,y:0,z:0},_=fe(e.polygons);try{for(_.s();!(o=_.n()).done;)for(var l=o.value,E=0;E<e.noSides;E++)a==l.pointReference[E]&&(l.normal?(r=i,n=l.normal,r.x=r.x+n.x,r.y=r.y+n.y,r.z=r.z+n.z):console.log("Polygon has null normal"))}catch(e){_.e(e)}finally{_.f()}t.push(i)}e.normals=t}}function de(e){var r,n=fe(e.normals);try{for(n.s();!(r=n.n()).done;)ue(r.value)}catch(e){n.e(e)}finally{n.f()}e.DONE_SMOOTH_NORMALS=!0}function Oe(e,r,n){try{for(var t=r.nSides,a=[],o=[],i=0;i<t;i++)o[i]=r.pointReference[i],o[i]>n-1?console.log("Exceeded vertices array size: nVertices: "+n+", index: "+o[i]):a[i]=e.vertices[o[i]];if(a[0]&&a[1]&&a[2]){var _=function(e,r,n){return t={x:r.x-e.x,y:r.y-e.y,z:r.z-e.z},a={x:n.x-e.x,y:n.y-e.y,z:n.z-e.z},ue(o={x:t.y*a.z-t.z*a.y,y:t.z*a.x-t.x*a.z,z:t.x*a.y-t.y*a.x}),o;var t,a,o}(a[0],a[1],a[2]);r.normal=_}}catch(r){console.log(e.id+" Normal out of range",r)}}function Ae(e,r,n,t,a,o){var i=Y(e,n),_=Y(t,o);return function(e,r,n,t,a,o){var i=e.layers[n],_=t.layers[o];if(i&&_){var l=le(e,r),E=le(t,a),s=i.splineLayer.surface,R=_.splineLayer.surface;return l&&E&&(l.vertices&&E.vertices?function(e,r,n,t,a,o){if(r.nodes.length>0&&a.nodes.length>0){for(var i=[],_=[],l=0;l<r.nodes.length;l++){for(var E=n+l,s=0,R=1e9,T=0;T<a.nodes.length;T++){var u=o+T,f=e.vertices[E],c=t.vertices[u];if(f&&c){var y=L({x:f.x,y:f.z},{x:c.x,y:c.z});y<R&&(s=u,R=y)}else console.log("vertexA or vertexB was missing")}R<300?Se(e,t,E,s,i,l):(console.log("No vertex within tolerance"),Ie(e,E,i,l))}for(var d=0;d<a.nodes.length;d++){for(var O=o+d,A=0,S=1e9,I=0;I<r.nodes.length;I++){var m=n+I,h=e.vertices[m],p=t.vertices[O];if(h&&p){var H=L({x:h.x,y:h.z},{x:p.x,y:p.z});H<S&&(A=m,S=H)}else console.log("vertexA or vertexB was missing")}S<300&&Se(t,e,O,A,_,d)}for(var N=0;N<r.nodes.length;N++){var v=i[N];v?e.normals[n+N]=v:console.log(e.id+" Normal was NULL: iNodeA: "+N)}for(var P=0;P<a.nodes.length;P++){var x=_[P];x?t.normals[o+P]=x:console.log(t.id+" Normal was NULL: iNodeB: "+P)}}}(l,s,Ee(e,l,n),E,R,Ee(t,E,o)):console.log(l.id+" or "+E.id+" had empty vertices")),!0}return!1}(e,r,i.value,t,a,_.value)}function Se(e,r,n,t,a,o){try{var i=e.normals[n],_=r.normals[t];null!=i&&null!=_?a[o]=(E=_,{x:(l=i).x+E.x,y:l.y+E.y,z:l.z+E.z}):console.log(" Vector was null, vIndexB: "+n+", vNearest: "+t)}catch(e){console.error(e)}var l,E}function Ie(e,r,n,t){try{var a=e.normals[r];null!=a?n[t]=CopyBean.copy(a):console.log(e.id+" Vector was null, vIndexB: "+r+", list size: "+e.normals.length)}catch(r){console.log(e.id+" Out of bounds")}}function me(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return he(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}function he(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function pe(e,r){var n,t=me(r.splineRegions);try{for(t.s();!(n=t.n()).done;){var a=n.value;_[r.id]==_.TORSO?(e.noTorso||5!=a.id&&4!=a.id||He(r,a,e.colour),e.noBust||3!=a.id&&8!=a.id||He(r,a,e.colour),e.noHead||14==a.id&&He(r,a,e.colour)):_[r.id]==_.CHEST_WALL?e.noTorso||e.noBust||3==a.id&&He(r,a):_[r.id]==_.LEFT_LEG||_[r.id]==_.RIGHT_LEG?e.noLegs||13!=a.id&&7!=a.id&&6!=a.id||He(r,a,e.colour):_[r.id]==_.RIGHT_ARM||_[r.id]==_.LEFT_ARM?e.noArms||15!=a.id&&18!=a.id||He(r,a,e.colour):_[r.id]==_.MJB_BUST&&(3!=a.id&&8!=a.id||He(r,a,e.colour))}}catch(e){t.e(e)}finally{t.f()}}function He(e,r,n){if(e.layers.length){for(var t=[],a=r.startLayer,o=r.endLayer,i=a;i<=o;i++){var _=e.layers[i];if(_.splineLayer&&_.splineLayer.surface){var l=_.splineLayer.surface;t=t.concat(h(l,_.y))}else console.log(e.id+" "+r.id+" Spline layer empty")}r.vertices=t,r.extent=W(t)}else console.log(e.id+" "+r.id+" Layers are empty")}function Ne(e,r,n){var t,a=me(r.splineRegions);try{for(a.s();!(t=a.n()).done;){var o=t.value;console.log(r.id+", "+o.id),o.noSides=n,_[r.id]==_.TORSO?(e.noTorso||5!=o.id&&4!=o.id&&8!=o.id||ve(r,o),e.noBust||3==o.id&&ve(r,o),e.noHead||14==o.id&&ve(r,o)):_[r.id]==_.CHEST_WALL?e.noTorso||e.noBust||3==o.id&&ve(r,o):_[r.id]==_.LEFT_LEG||_[r.id]==_.RIGHT_LEG?e.noLegs||13!=o.id&&7!=o.id&&6!=o.id||ve(r,o):_[r.id]==_.LEFT_ARM||_[r.id]==_.RIGHT_ARM?e.noArms||15!=o.id&&18!=o.id||ve(r,o):_[r.id]==_.MJB_BUST&&(3!=o.id&&8!=o.id||ve(r,o))}}catch(e){a.e(e)}finally{a.f()}}function ve(e,r){var n=r.startLayer,t=r.endLayer;if(t>n){for(var a=r.startVertex,o=[],i=n;i<t;i++){var _=e.layers[i],l=e.layers[i+1];if(_)if(null!=l)if(null!=_.splineLayer)if(null!=l.splineLayer){var E=_.splineLayer.surface,s=l.splineLayer.surface;if(E.nodes.length)if(s.nodes.length)if(E.nodes.length==s.nodes.length)if(_.y!=l.y){var R=a+E.nodes.length,T=2*E.nodes.length;if(o.length+T<32766){for(var L=0;L<E.nodes.length-2;L++){var u=Pe(r,R+L,R+L+1,a+L);o.push(u);var f=Pe(r,a+L,R+L+1,a+L+1);o.push(f)}var c=E.nodes.length-2,y=Pe(r,R+c,R,a+c);o.push(y);var d=Pe(r,a+c,R,a);o.push(d)}a+=E.nodes.length}else console.log("CubicSpline Same Y Level: A: size: "+E.nodes.length+", y: "+_.y+", B: size: "+s.nodes.length+", y: "+l.y);else console.log(" CubicSpline Node size not equal: A: size: "+E.nodes.length+", y: "+_.y+", B: size: "+s.nodes.length+", y: "+l.y);else console.log(e.id+" "+r.id+" "+l.id+" splineLayer is empty: counter: "+(i+1));else console.log(e.id+" "+r.id+" "+l.id+" splineLayer is empty: counter: "+(i+1))}else console.log(e.id+" "+r.id+" "+l.id+" splineLayer is null: counter: "+(i+1));else console.log(e.id+" "+r.id+" "+_.id+" splineLayer is null: counter: "+i);else console.log(e.id+" "+r.id+" layer is null: counter: "+(i+1));else console.log(e.id+" "+r.id+" layer is null: counter: "+i)}r.polygons=o}}function Pe(e,r,n,t){var a=e.vertices.length-1;if(r>a)return console.log("Point Reference 0: Index: "+r+", Exceeded array max: "+a),null;if(n>a)return console.log("Point Reference 1: Index: "+n+", Exceeded array max: "+a),null;if(t>a)return console.log("Point Reference 2: Index: "+t+", Exceeded array max: "+a),null;var o={};o.nSides=e.noSides;var i=[];return i.push(r),i.push(n),i.push(t),o.pointReference=i,o}const xe={AXF_HEIGHT:1,AXF_NECK_GIRTH:2,AXF_CHEST_GIRTH:3,AXF_BUST_GIRTH:4,AXF_BUST_WIDTH:5,AXF_UNDER_BUST_GIRTH:6,AXF_LOW_CHEST_GIRTH:7,AXF_WAIST_GIRTH:8,AXF_TOP_HIP_GIRTH:9,AXF_SEAT_PROMINENCE_GIRTH:10,AXF_HIP_GIRTH:11,AXF_NAPE_HEIGHT:20,AXF_BUST_HEIGHT:21,AXF_UNDER_BUST_HEIGHT:22,AXF_WAIST_HEIGHT:23,AXF_HIP_HEIGHT:24,AXF_CROTCH_HEIGHT:25,AXF_FRONT_NECK_HEIGHT:26,AXF_TORSO_LENGTH_CROTCH_ARMPIT:27,AXF_NIPPLE_WIDTH:40,AXF_NAPE_TO_WAIST:41,AXF_THROUGH_RISE:42,AXF_NAPE_TO_LEFT_NIPPLE:43,AXF_NAPE_TO_RIGHT_NIPPLE:44,AXF_CENTRE_SHOULDER_TO_REAR_WAIST:45,AXF_BACK_SHOULDER_WIDTH:46,AXF_NAPE_TO_LEFT_SIDE_NECK:47,AXF_NAPE_TO_RIGHT_SIDE_NECK:48,AXF_LEFT_SIDE_NECK_TO_NIPPLE:49,AXF_RIGHT_SIDE_NECK_TO_NIPPLE:50,AXF_CENTRE_SHOULDER_TO_FRONT_WAIST:51,AXF_LEFT_THIGH_GIRTH:70,AXF_RIGHT_THIGH_GIRTH:71,AXF_LEFT_KNEE_GIRTH:72,AXF_RIGHT_KNEE_GIRTH:73,AXF_LEFT_CALF_GIRTH:74,AXF_RIGHT_CALF_GIRTH:75,AXF_LEFT_MINIMUM_LEG_GIRTH:76,AXF_RIGHT_MINIMUM_LEG_GIRTH:77,AXF_LEFT_ANKLE_GIRTH:78,AXF_RIGHT_ANKLE_GIRTH:79,AXF_LEFT_KNEE_HEIGHT:80,AXF_RIGHT_KNEE_HEIGHT:81,AXF_INSIDE_LEG:82,AXF_LEFT_MID_THIGH_GIRTH:83,AXF_RIGHT_MID_THIGH_GIRTH:84,AXF_LEFT_ARM_LENGTH:90,AXF_RIGHT_ARM_LENGTH:91,AXF_LEFT_UNDER_ARM_LENGTH:92,AXF_RIGHT_UNDER_ARM_LENGTH:93,AXF_LEFT_SHOULDER_SLOPE:94,AXF_RIGHT_SHOULDER_SLOPE:95,AXF_LEFT_UPPER_ARM_GIRTH:96,AXF_RIGHT_UPPER_ARM_GIRTH:97,AXF_LEFT_SHOULDER_TO_ELBOW:98,AXF_RIGHT_SHOULDER_TO_ELBOW:99,AXF_LEFT_ELBOW_TO_WRIST:100,AXF_RIGHT_ELBOW_TO_WRIST:101,AXF_LEFT_ARMPIT_TO_ARMCREASE:102,AXF_RIGHT_ARMPIT_TO_ARMCREASE:103,AXF_LEFT_ARMCREASE_TO_WRIST:104,AXF_RIGHT_ARMCREASE_TO_WRIST:105,AXF_LEFT_SHOULDER_LENGTH:106,AXF_RIGHT_SHOULDER_LENGTH:107,AXF_TORSO_LENGTH_CROTCH_ARMPIT_OLD:108,AXF_BUST_PROMINENCE_UPPER:200,AXF_BUST_PROMINENCE_LOWER:201,AXF_BUST_ANGLE:206,AXF_ABDOMEN_PROMINENCE_UPPER:210,AXF_ABDOMEN_PROMINENCE_LOWER:211,AXF_LEFT_FRONT_LATERAL_DEVIATION_UPPER:212,AXF_RIGHT_FRONT_LATERAL_DEVIATION_UPPER:213,AXF_LEFT_FRONT_LATERAL_DEVIATION_LOWER:214,AXF_RIGHT_FRONT_LATERAL_DEVIATION_LOWER:215,AXF_SEAT_PROMINENCE_UPPER:220,AXF_SEAT_PROMINENCE_LOWER:221,AXF_BACK_PROMINENCE_UPPER:230,AXF_BACK_PROMINENCE_LOWER:231,AXF_SIDE_BILATERAL_CROTCH:232,AXF_SIDE_BILATERAL_WAIST:233,AXF_SIDE_BILATERAL_ARMPIT:234,AXF_FRONT_BILATERAL_CROTCH:235,AXF_FRONT_BILATERAL_HIP:236,AXF_FRONT_BILATERAL_WAIST:237,AXF_FRONT_BILATERAL_ARMPIT:238,AXF_FRONT_BILATERAL_MIDHIP:239,AXF_BVI:240,AXF_TORSO_FRONT_CURVINESS:250,AXF_TORSO_REAR_CURVINESS:251,fromInt:function(e){return Object.entries(this).filter((function(e){return"properties"!==e[0]&&"function"!=typeof e[0]})).find((function(r){return r[1]===e}))}};function Ge(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function ge(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new i(e),t={};return Fe(t,n),t.version<1.999&&(t.noHead=!0,t.noArms=!0),t.landmarks=Me(n),t.version>1.999&&(t.referenceLocations=We(n)),be(t,n),t.bodyParts=we(n,t.rawPointsDefined,t.surfaceDefined,t.colour,t.version),n.close(),Be(t,r),t}function Fe(e,r){e.version=r.readFloat(),e.colour=r.javaBoolean(),e.sex=r.sexType(),e.yResolutionMM=r.readFloat(),e.xZResolutionMM=r.readFloat(),e.rawPointsDefined=r.javaBoolean(),e.surfaceDefined=r.javaBoolean(),e.normalisedPointsInLayer=r.javaBoolean(),e.normalisedLayersInRegion=r.javaBoolean()}function Me(e){for(var r=[],n=e.readShort(),t=0;t<n;t++){var a=Ce(e);r.push(a)}return r}function Ce(e){var r=e.readShort(),n=X.fromInt(r);null==n&&console.log("No landmark type with id: "+r);var t={};return t.id=n,t.x=e.readShort(),t.y=e.readShort(),t.z=e.readShort(),t}function We(e){for(var r=[],n=e.readShort(),t=0;t<n;t++){var a={};a.id=e.readShort(),a.bodypartID=e.readShort(),a.layerId=e.readShort(),a.pointId=e.readInt(),a.visible=!1,r.push(a)}return r}function be(e,r){var n=r.readShort();e.personDetails=[],e.measurements=[];for(var t=0;t<n;t++)e.personDetails.push(r.readShort());var a,o=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return Ge(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ge(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}(e.personDetails);try{for(o.s();!(a=o.n()).done;)switch(a.value){case 2:case 3:break;case 1:for(var i=r.readShort(),_=0;_<i;_++)e.measurements.push(ze(r));break;case 4:e.chestWallDefinition=De(r,e.version)}}catch(e){o.e(e)}finally{o.f()}}function ze(e){var r=e.readShort(),n=xe.fromInt(r);null==n&&log.severe("No measurement type with id: "+r);var t={};return t.id=n,t.value=e.readFloat(),t}function we(e,r,n,t,a){for(var o=[],i=e.readShort(),_=0;_<i;_++){var l=Ue(e,r,n,t,a);null!=l&&o.push(l)}return o}function Ue(e,r,t,a,o){var i=e.readShort(),l=_.fromInt(i);if(null==l)return console.error("Bodypart not recognised"),null;console.log("Reading bodypart id: "+_[l]+", name: "+l);var E=e.readShort(),s=e.readShort();console.log("Number of layers: "+s);for(var R=[],T=0;T<s;T++){var L=Ke(e,r,t,a,o);null==L?n("failedLayer"):R.push(L)}return{id:l,layerOffset:E,layers:R}}function Ke(e,r,n,t,a){var o={y:e.readShort()};if(1==r&&(o.pointLayer=function(e,r,n){for(var t={},a=[],o=[],i=e.readShort(),_=0;_<i;_++){var l={},E={};l.x=e.readShort(),l.y=r,l.z=e.readShort(),1==n?(E.x=e.readByte(),E.y=e.readByte(),E.z=e.readByte()):(E.x=255,E.y=255,E.z=255),a.push(l),o.push(E)}return t.points=a,t.colours=o,t}(e,o.y,t)),1==n){var i=function(e,r,n){var t=function(e,r,n){for(var t=[],a=e.readShort(),o=0;o<a;o++){var i={};1==r?i.point={x:e.readDouble(),y:e.readDouble()}:r>1.0001&&r<3.99999?i.point={x:e.readShort(),y:e.readShort()}:r>=3.99999&&(i.point={x:e.readFloat(),y:e.readFloat()}),i.colour=1==n?{x:e.readByte(),y:e.readByte(),z:e.readByte()}:{x:255,y:255,z:255},t.push(i)}if(!t.length)return null;var _={nodes:t};return y(_),_.surfaceMeasure=function(e,r,n){for(var t=0,a=0,o=r;o<n;o++){for(var i=e.parametricCoefficients.xs_coeffs[o],_=e.parametricCoefficients.ys_coeffs[o],l=e.parametricNodes.xsPoints[o].x,E=e.parametricNodes.xsPoints[o].x,s=(E-l)/22,R=O(i,_,l,l),T=O(i,_,l,E),L=0,u=1;u<10;u++)L=L+4*O(i,_,l,t=l+(2*u-1)*s)+2*O(i,_,l,t=l+2*u*s);a+=s*(R+L+4*O(i,_,l,t+=s)+T)/3}return a}(_,0,_.nodes.length-1),_}(e,r,n);return null==t?null:{surface:t}}(e,a,t);if(null==i)return console.error("Empty spline, layer ignored: y: "+o.y),null;o.splineLayer=i}return o}function De(e,r){var n={};return n.useMidBust=e.javaBoolean(),r>3.01&&(n.regenerateArmpitPoints=e.javaBoolean()),n.threeLines=e.javaBoolean(),n.armpit_z_biasL=e.readDouble(),n.armpit_z_biasR=e.readDouble(),r>3&&(n.chest_z_biasL=e.readDouble(),n.chest_z_biasR=e.readDouble()),n.waist_z_biasL=e.readDouble(),n.waist_z_biasR=e.readDouble(),n.left_bust_x_bias=e.readDouble(),n.right_bust_x_bias=e.readDouble(),n.mid_bust_x_bias=e.readDouble(),n.z_midspline_adjust_highchest=e.readShort(),n.z_midspline_adjust_armpit=e.readShort(),n.z_midspline_adjust_bust=e.readShort(),n.z_midspline_adjust_underbust=e.readShort(),n.z_midspline_adjust_waist=e.readShort(),n.z_leftspline_adjust_highchest=e.readShort(),n.z_leftspline_adjust_armpit=e.readShort(),n.z_leftspline_adjust_bust=e.readShort(),n.z_leftspline_adjust_underbust=e.readShort(),n.z_leftspline_adjust_waist=e.readShort(),n.z_rightspline_adjust_highchest=e.readShort(),n.z_rightspline_adjust_armpit=e.readShort(),n.z_rightspline_adjust_bust=e.readShort(),n.z_rightspline_adjust_underbust=e.readShort(),n.z_rightspline_adjust_waist=e.readShort(),n.y_midspline_adjust_highchest=e.readShort(),n.y_midspline_adjust_armpit=e.readShort(),n.y_midspline_adjust_bust=e.readShort(),n.y_midspline_adjust_underbust=e.readShort(),n.y_midspline_adjust_waist=e.readShort(),n.y_leftspline_adjust_highchest=e.readShort(),n.y_leftspline_adjust_armpit=e.readShort(),n.y_leftspline_adjust_bust=e.readShort(),n.y_leftspline_adjust_underbust=e.readShort(),n.y_leftspline_adjust_waist=e.readShort(),n.y_rightspline_adjust_highchest=e.readShort(),n.y_rightspline_adjust_armpit=e.readShort(),n.y_rightspline_adjust_bust=e.readShort(),n.y_rightspline_adjust_underbust=e.readShort(),n.y_rightspline_adjust_waist=e.readShort(),n}function Be(e,r){!function(e){N(e);var r,n={x:(e.extent.min.x+e.extent.max.x)/2,y:(e.extent.min.y+e.extent.max.y)/2,z:(e.extent.min.z+e.extent.max.z)/2},t=b(e.bodyParts);try{for(t.s();!(r=t.n()).done;)w(r.value,n)}catch(e){t.e(e)}finally{t.f()}var a,o=b(e.landmarks);try{for(o.s();!(a=o.n()).done;){var i=a.value;i.x=i.x-n.x,i.y=i.y-n.y,i.z=i.z-n.z}}catch(e){o.e(e)}finally{o.f()}N(e)}(e),function(e){var r,n,t=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return Re(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Re(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,_=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){_=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(_)throw o}}}}(e.bodyParts);try{for(t.s();!(r=t.n()).done;)(n=r.value).frontSilhouette=function(e){var r=[];switch(e.id){case"LEFT_LEG":case"RIGHT_LEG":r.push(Te(e,1,0,0,2,1,2)),r.push(Te(e,2,0,0,2,2,2));break;case"LEFT_ARM":case"RIGHT_ARM":r.push(Te(e,9,0,0,2,1,2)),r.push(Te(e,10,0,0,2,2,2));break;case"TORSO":r.push(Te(e,17,0,0,2,1,2)),r.push(Te(e,20,0,0,2,2,2));break;default:return null}return r}(n),n.sideSilhouette=function(e){var r=[];return _[e.id]==_.LEFT_LEG||_[e.id]==_.RIGHT_LEG?(r.push(Te(e,6,0,0,2,2,1)),r.push(Te(e,5,0,0,2,1,1))):_[e.id]==_.TORSO&&(r.push(Te(e,24,0,0,2,2,1)),r.push(Te(e,24,0,0,1,2,1)),r.push(Te(e,25,0,0,2,1,1)),r.push(Te(e,25,0,0,1,1,1))),r}(n)}catch(e){t.e(e)}finally{t.f()}}(e),e.surfaceDefined&&(e.normaliseResolution=function(e){var r=E(e,_.TORSO);if(null==r)return null;switch(s(r).splineLayer.surface.nodes.length){case 33:return 1;case 49:return 2;case 65:return 3}}(e),oe(e,!1),function(e,r,n){var t,a=me(e.bodyParts);try{for(a.s();!(t=a.n()).done;){var o=t.value;pe(e,o),Ne(e,o,3)}}catch(e){a.e(e)}finally{a.f()}n&&function(e){!function(e){var r,n=fe(e.bodyParts);try{for(n.s();!(r=n.n()).done;){var t,a=r.value,o=fe(a.splineRegions);try{for(o.s();!(t=o.n()).done;){var i=t.value;i.vertices&&i.vertices.length?(ye(i),i.DONE_SMOOTH_NORMALS=!0):console.error(a.id+" "+i.id+" Vertices list is NULL")}}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}}(e),function(e){if(!(e.version<1.999)){var r=E(e,_.TORSO),n=E(e,_.LEFT_LEG),t=E(e,_.RIGHT_LEG),a=E(e,_.LEFT_ARM),o=E(e,_.RIGHT_ARM),i=E(e,_.MJB_BUST);if(r&&(e.noHead||e.noTorso||Ae(r,8,$.TORSO_NECK_LOWER,r,14,$.TORSO_NECK_UPPER),e.noTorso||(Ae(r,3,$.TORSO_ARMPIT_LOWER,r,8,$.TORSO_ARMPIT_UPPER),Ae(r,4,$.TORSO_WAIST_LOWER,r,3,$.TORSO_WAIST_UPPER),Ae(r,5,$.TORSO_HIP_LOWER,r,4,$.TORSO_HIP_UPPER)),e.noTorso||e.noLegs||(n&&Ae(r,5,$.TORSO_CROTCH,n,6,$.LEFTLEG_THIGH),t&&Ae(r,5,$.TORSO_CROTCH,t,6,$.RIGHTLEG_THIGH))),e.noLegs||(n&&(Ae(n,6,$.LEFTLEG_KNEE_UPPER,n,7,$.LEFTLEG_KNEE_LOWER),Ae(n,7,$.LEFTLEG_ANKLE_UPPER,n,13,$.LEFTLEG_ANKLE_LOWER)),t&&(Ae(t,6,$.RIGHTLEG_KNEE_UPPER,t,7,$.RIGHTLEG_KNEE_LOWER),Ae(t,7,$.RIGHTLEG_ANKLE_UPPER,t,13,$.RIGHTLEG_ANKLE_LOWER))),e.noArms||(a&&Ae(a,15,$.LEFTARM_ELBOW_UPPER,a,18,$.LEFTARM_ELBOW_LOWER),o&&Ae(o,15,$.RIGHTARM_ELBOW_UPPER,o,18,$.RIGHTARM_ELBOW_LOWER)),i){var l=se(i,3,10);Ae(i,8,se(i,8,9),i,3,l)}}}(e),function(e){var r,n=fe(e.bodyParts);try{for(n.s();!(r=n.n()).done;){var t,a=fe(r.value.splineRegions);try{for(a.s();!(t=a.n()).done;){var o=t.value;o.vertices&&o.vertices.length?de(o):console.error(o.id+" Vertices list is NULL")}}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}}(e)}(e),e.surfaceDefined=!0}(e,0,r))}function Xe(e,r,n){var t=JSON.parse(JSON.stringify(e));return t.bodyParts.forEach((function(e,t){!function(e,r,n){e.layers.forEach((function(e,t){!function(e,r,n){var t=e.y,a=r.y;e.y=(1-n)*t+n*a,function(e,r,n){e.nodes.forEach((function(e,t){var a=r.nodes[t],o=e.point.x,i=e.point.y,_=a.point.x,l=a.point.y;e.point.x=(1-n)*o+n*_,e.point.y=(1-n)*i+n*l}))}(e.splineLayer.surface,r.splineLayer.surface,n)}(e,r.layers[t],n)}))}(e,r.bodyParts[t],n)})),t}function ke(e){for(var r=new i(e),n=(r.readNumericType("Int32"),r.readNumericType("Int32"),r.readNumericType("Int32"),r.readNumericType("Int8"),r.readNumericType("Int32")),t=[],a=0;a<n;a++){var o=r.readNumericType("Int32");t.push({sensorSize:o,points:[]})}for(var _=0,l=t;_<l.length;_++)for(var E=l[_],s=0;s<E.sensorSize;s++)E.points.push({x:r.readFloat(),y:r.readFloat(),z:r.readFloat()});return console.log("Finished reading coords"),t}var je=r.w2,Ve=r.$r,$e=r.xd,Ye=r.Kz;export{je as ReadBinaryFile,Ve as fitSplinesBody,$e as morphBody,Ye as readAxf};